Use of image registration and fusion algorithms and techniques in
radiotherapy: Report of the AAPM Radiation Therapy Committee Task
Group No. 132
          Kristy K. Brocka)
          Department of Imaging Physics, The University of Texas MD Anderson Cancer Center, 1400 Pressler St, FCT 14.6048, Houston,
          TX 77030, USA
          Sasa Mutic
          Department of Radiation Oncology, Washington University School of Medicine, St. Louis, MO, USA
          Todd R. McNutt
          Department of Radiation Oncology, Johns Hopkins Medical Institute, Baltimore, MD, USA
          Hua Li
          Department of Radiation Oncology, Washington University School of Medicine, St. Louis, MO, USA
          Marc L. Kessler
          Department of Radiation Oncology, University of Michigan, Ann Arbor, MI, USA

          (Received 7 January 2016; revised 13 February 2017; accepted for publication 19 February 2017;
          published 23 May 2017)
          Image registration and fusion algorithms exist in almost every software system that creates or uses
          images in radiotherapy. Most treatment planning systems support some form of image registration
          and fusion to allow the use of multimodality and time-series image data and even anatomical atlases
          to assist in target volume and normal tissue delineation. Treatment delivery systems perform registra-
          tion and fusion between the planning images and the in-room images acquired during the treatment
          to assist patient positioning. Advanced applications are beginning to support daily dose assessment
          and enable adaptive radiotherapy using image registration and fusion to propagate contours and accu-
          mulate dose between image data taken over the course of therapy to provide up-to-date estimates of
          anatomical changes and delivered dose. This information aids in the detection of anatomical and
          functional changes that might elicit changes in the treatment plan or prescription.
             As the output of the image registration process is always used as the input of another process for
          planning or delivery, it is important to understand and communicate the uncertainty associated with
          the software in general and the result of a specific registration. Unfortunately, there is no standard
          mathematical formalism to perform this for real-world situations where noise, distortion, and com-
          plex anatomical variations can occur. Validation of the software systems performance is also compli-
          cated by the lack of documentation available from commercial systems leading to use of these
          systems in undesirable ‘black-box’ fashion.
             In view of this situation and the central role that image registration and fusion play in treatment
          planning and delivery, the Therapy Physics Committee of the American Association of Physicists in
          Medicine commissioned Task Group 132 to review current approaches and solutions for image regis-
          tration (both rigid and deformable) in radiotherapy and to provide recommendations for quality assur-
          ance and quality control of these clinical processes. © 2017 American Association of Physicists in
          Medicine [https://doi.org/10.1002/mp.12256]

          Key words: adaptive radiotherapy, image fusion, image registration, quality assurance

TABLE OF CONTENTS                                                            d. Domain of transformation
                                                                             e. Interaction
1. INTRODUCTION
                                                                             f. Optimization procedure
 a. Image data in radiotherapy
                                                                             g. Modalities involved
 b. Use of image registration and fusion in radiotherapy
                                                                             h. Subject
 c. Clinical integration of image registration and fusion QA program
                                                                              i. Limitations and challenges
 d. Glossary of terms
                                                                            3. CLINICAL ISSUES AND APPLICATIONS OF IMAGE
2. TECHNIQUES FOR IMAGE REGISTRATION                                        REGISTRATION IN RADIOTHERAPY
 a. Dimensionality                                                           a. Sources of error due to data acquisition
 b. Nature of registration basis                                             b. Sources of error in registration
 c. Nature of transformation                                                 c. Image registration for segmentation



e43    Med. Phys. 44 (7), July 2017           0094-2405/2017/44(7)/e43/34     © 2017 American Association of Physicists in Medicine   e43
e44      Brock et al.: TG 132: Image registration                                                                                                    e44


 d. Image registration for multimodality or adaptive treatment planning         ii. System end-to-end tests with physical phantom
 e. Image registration for image-guided radiotherapy                            iii. Digital phantom tests
   f. Image registration for response assessment                                iv. Example clinical data tests
4. METHODS FOR VALIDATION AND QUALITY ASSURANCE                             b. Patient-specific registration verification during clinical practice
 a. General concepts                                                      6. CLINICAL INTEGRATION OF REGISTRATION TECHNIQUES IN
 b. Qualitative evaluation of image registration and accuracy             TREATMENT PLANNING AND DELIVERY
 c. Quantitative measures of image registration and accuracy                a. Treatment planning
 d. Specific considerations of phantoms                                     b. Treatment delivery
 e. QA at treatment planning                                                c. Treatment monitoring and adaptation
 f. QA at treatment delivery                                                 d. Clinical case illustrations
5. COMMISSIONING OF IMAGE REGISTRATION SOFTWARE                           7. CONCLUSIONS
   a. Commissioning                                                       8. APPENDICES
      i. Software system specific validation                              9. REFERENCES


1. INTRODUCTION
                                                                          1.B.1. Image registration for segmentation
1.A. Image data in radiotherapy
                                                                             Image registration is often used to segment (manually, semi-
    The practice of modern radiotherapy involves the quanti-              automatically, or automatically) target volumes and normal tis-
tative use of several types of image data. Image data from                sues through anatomical atlases or between images of the same
various modalities are used in treatment planning, treatment              patient obtained at different time points (e.g., adaptation).
delivery and treatment monitoring. In the process of treat-
ment planning, X-ray computed tomography (CT) is typi-
                                                                          1.B.2. Image registration for multimodality or
cally used as the primary imaging modality to construct
                                                                          adaptive treatment planning
detailed three dimensional anatomic and physical models of
the patient. These models are used to design beam arrange-                   Image registration and fusion are often used in treatment
ments and shapes, to calculate the dose delivered by these                planning to combine information obtained from different
beams and as a guide to position the patient for treatment.               imaging modalities (e.g., MR, PET, SPECT, and CT)
Magnetic resonance imaging (MRI) techniques provide                       together for delineation of tumor volumes and/or normal tis-
exquisite soft tissue contrast for tissue delineation and esti-           sues. Registration is also used to map regions of interest
mates of physiologic and metabolic information. Nuclear                   delineations from one imaging study of the patient to another
medicine imaging techniques such as positron emission                     or from a reference set of anatomical contours to a patient-
tomography (PET) and single photon emission computed                      specific image. Software systems that support adaptive radio-
tomography (SPECT) provide dynamic data on physiologic                    therapy use image registration and fusion to propagate dose
and metabolic process such as glucose metabolism and                      from 3D treatment images back to a reference (planning)
DNA synthesis.                                                            geometry, enable detection of anatomic and functional
    During the process of treatment delivery, volumetric x-ray            changes that might elicit changes in the treatment plan or pre-
imaging technology has been incorporated into the treatment               scription, and provide up-to-date estimates of delivered dose.
rooms as kilovoltage (kV) and megavoltage (MV) CT imag-
ing systems with fan-beam and cone-beam geometries. Real-                 1.B.3. Image registration for image-guided
time volumetric ultrasound (US) can also be used to localize              radiotherapy
internal anatomy at the time of treatment. Research and
                                                                              Treatment delivery systems use image registration and
development is currently ongoing to enable integration of
                                                                          fusion between images used for planning and images acquired
real-time MR imaging directly with treatment machines. In
                                                                          at the time of treatment to assist with patient positioning. Regis-
addition to general set up and target localization, these on-
                                                                          tration is required to determine the offset of the patient at the
board images can also be used to monitor and track soft tissue
                                                                          time of treatment from the planned position. The transforma-
changes during therapy and to support plan adaptation.
                                                                          tion determined from the image registration is typically used to
                                                                          perform an adjustment to the patient position.
1.B. Use of image registration and fusion in
radiotherapy                                                              1.B.4. Image registration for response assessment
    Image registration is the process of determining the geo-                 The evaluation of treatment response also uses image reg-
metric transformation that relates identical (anatomic) points            istration between the images used for treatment planning and
in two image series: a moving dataset (Study A) and a sta-                those obtained at follow-up. Although registration is not
tionary source dataset (Study B). The main uses of image reg-             required for simple comparisons of tumor measurements,
istration and fusion in radiotherapy can be categorized into              more advanced assessment, e.g., changes in functional imag-
the following three essential steps.                                      ing, requires precision in image registration.

Medical Physics, 44 (7), July 2017
e45     Brock et al.: TG 132: Image registration                                                                                      e45


   The requirements and challenges for timeliness and accu-          quickly an image registration needs to be performed and veri-
racy vary between the above four main uses. Image registration       fied), the capabilities of a specific registration software pack-
for planning has relaxed time constraints, as the process typi-      age, etc. Figure 1 shows a typical clinical implementation of
cally spans several days. However, image registration at the         image registration process and the possible locations where
treatment delivery unit has high demands for timeliness, as the      this and other task group’s recommendations are applicable.
patient is awaiting treatment. This includes registration for        The figure also shows image registration practices are likely
treatment delivery and online treatment adaptation. Although         as diverse as any other process in radiotherapy and global
high levels of accuracy are expected in all applications, the        recommendations, which are universally applicable to all
impact of inaccuracies often depends on the propagation of           individual applications, are impractical. The concepts
that error. Registration errors made during treatment planning       described here provide a general approach and framework
will impact the entire treatment course, therefore resulting in a    which individual facilities should consider to ensure that they
high demand for accuracy. Registration errors made at an indi-       perform high-quality and safe radiotherapy. However, it is
vidual fraction of treatment delivery will likely impact the         ultimately the responsibility of the individual facilities and
delivery of that fraction only. For a treatment course with a        their individual QAC to determine the appropriateness of rec-
large number of fractions, the impact of an error at one fraction    ommendations provided here to their individual use cases
will be less. Systematic errors in image registration or operator    and the needs of their image registration program.
error in the registration process may impact the delivery of all
treatment fractions. The impact of inaccuracies in adaptation
                                                                     1.D. Glossary of terms
depends on the timing of the adaptation and the fraction of the
planned dose that will be delivered under the new plan.                 Image registration — the process of determining the geo-
                                                                     metric transformation that relates identical (anatomic) points
                                                                     in two image series: a moving dataset (Study A) and a sta-
1.C. Clinical integration of image registration and
                                                                     tionary source dataset (Study B).
fusion QA program
                                                                        Image fusion — the combined display of the mapped data
   This task group recommends implementation of a formal             from the moving dataset with the stationary dataset.
image registration quality assurance (QA) program in individual         Transformation — the function that is applied to the mov-
facilities. The program should be guided and structured based        ing image (Study A) to align it to the stationary image (Study B).
on the recommendations provided here with the considerations            Registration (or similarity) metric — quantifies the
described below. The main purpose of the program should be to        degree to which the pair of imaging studies are aligned.
ensure accuracy and quality of individual patient image registra-       Rigid registration — a registration where the transforma-
tion. The organization and expectations of the program should        tion preserves the distance between all points in the image. A
be formally documented and the roles and responsibilities of         rigid registration can include translation in all directions as
individual practitioners in this process should be defined. The      well as rotations in all directions.
program should be managed by the Quality Assurance Commit-              Affine registration — a registration that includes the trans-
tee (QAC). The program considerations should include:                formations from rigid registration and adds the additional transfor-
                                                                     mations of scaling, shearing, and plane reflection. The distance
   1. Validation and quality assurance of image registration         between all points is not maintained, as in rigid registration, how-
      and fusion at treatment planning, treatment delivery,          ever parallel lines remain parallel after the transformation.
      adaptive re-planning, and response assessment                     Deformable registration — a registration transformation
   2. Commissioning image registration and fusion software           can also be spatially variant where the number of degrees of
      to ensure accuracy of the tools used                           freedom can be as large as three times the number of voxels
   3. Define/assign the role of each team member and tailor          in the source dataset (e.g., a unique displacement vector for
      workflow and tolerances appropriately depending on             every voxel in the source dataset).
      the intended use of the image registration
   4. Clinical verification of image registration for individual
                                                                     2. TECHNIQUES FOR IMAGE REGISTRATION
      patients.
                                                                         A brief review of image registration and fusion algorithms is
   It is intended that these recommendations will be used in         presented here. However, for a comprehensive description, the
conjunction with other recommendations of the AAPM task              reader is referred to the literature.1–7 For generalization purposes,
groups, as indicated in Fig. 1.                                      the following nomenclature will be used throughout the report:
   Details of the clinical implementation of this task group’s       Study A and Study B will refer to any two image sets to be regis-
recommendations can be varied for each specific institution and      tered in which A is the moving dataset (e.g., the dataset that is
depend on a broad scope of aspects which include: the individ-       being transformed or deformed to match another image), while
ual clinical setting and resources, the purpose of image registra-   B is the stationary dataset (e.g., the dataset that another image is
tion (Section 1.B), the timeline for an individual image             being registered to). It is important to note that these terms are
registration (when a registration is performed in the overall        intentionally general as the radiotherapy application will dictate
treatment process), the time allotted for image registration (how    which image is moving and which image is stationary. For

Medical Physics, 44 (7), July 2017
e46      Brock et al.: TG 132: Image registration                                                                                                     e46




FIG. 1. Image data and processing workflow in radiotherapy planning, treatment, and adaptation. Task Groups from the American Association of Physicists in
Medicine [TG]. [Color figure can be viewed at wileyonlinelibrary.com]



example, in radiation therapy treatment planning, if an MR                       F. Optimization procedure
image is to be registered to the CT planning image, the MR                       G. Modalities involved
image is the moving image and the CT is the stationary image.                    H. Subject
However, for adaptive radiotherapy, the original planning CT                     I. Object
may be the moving image and the mid-treatment CT the station-
ary image to enable the dose from the original CT to be mapped
onto the new CT. Transformation T will refer to the registration
                                                                                2.A. Dimensionality
matrix (rigid, affine, or deformable; as defined below) that will
describe where a point from the moving image maps on the fixed                      Images in radiotherapy can have a dimensionality of 2D or
image. A prime symbol will be used to denote the application of                 3D. For generalization and comprehensiveness, the images
the transformation matrix to the image set (e.g., Study A’ will                 are assumed to be 3D; however, the same principles apply for
indicate the result of applying a transformation T to Study A to                a 2D to 2D registration, only with fewer parameters reflecting
create an image that is registered to Study B).                                 only translation in two dimensions and rotation in one dimen-
   As summarized by Maintz and Viergever,8 registration is                      sion. Due to the inherent limitation in the data, 2D to 2D reg-
defined by 9 criteria:                                                          istration is generally limited to rigid registration in practical
                                                                                applications.
 A. Dimensionality
 B. Nature of registration basis
                                                                                2.B. Nature of registration basis
 C. Nature of transformation
 D. Domain of transformation                                                       The nature of the registration basis, whether the registra-
 E. Interaction                                                                 tion is extrinsic, e.g., using invasive or noninvasive frames,

Medical Physics, 44 (7), July 2017
e47     Brock et al.: TG 132: Image registration                                                                                                     e47


molds, or fiducials, or intrinsic, using image features or voxel     improve computational speed.9–12 In Chamfer matching, the
properties can simplify the registration and guide the user to       corresponding region in each image is segmented (either
select the best registration metric.                                 automatically, often using thresholding techniques, or manu-
   A registration metric must be devised which quantifies the        ally). The segmentation is then simplified into an image with
degree to which the pair of imaging studies are aligned.             0 and 1 values indicating the edge of the segmented region.
Using standard optimization techniques, the transformation           The optimization is then performed to minimize the distance
parameters are iteratively manipulated until this metric is          between the two segmented surfaces.
minimized or maximized, where the minimization or maxi-
mization of the metric corresponds to the best alignment of
                                                                     2.B.2. Intensity-based metrics
the two images. Most registration approaches in use today
can be classified as either geometry-based or intensity-based.           To overcome some of the limitations of using explicit geo-
Geometry-based metrics make use of features extracted from           metric features to register image data, another class of regis-
the image data such as anatomic or artificial landmarks and          tration metrics has been developed which uses the numerical
organ boundaries while intensity-based metrics use the image         grayscale information directly to measure how well two stud-
voxel data directly.                                                 ies are registered. These similarity metrics are also referred to
                                                                     as similarity measures as they determine the similarity
                                                                     between the distributions of corresponding voxel values from
2.B.1 Geometry or feature-based metrics
                                                                     Study B and a transformed version of Study A (e.g., A’). Sev-
    The most common geometry-based registration metrics              eral mathematical formulations are used to measure this simi-
involve the use of point matching or surface matching. For           larity. The more common similarity measures in clinical use
point matching, the coordinates of pairs of corresponding            include: sum of squared differences, cross-correlation, and
points from Studies A and B [pA and pB in Eq. (1)] are used          mutual information.
to define the registration metric. These points can be ana-              The sum of squared differences (SSD)13–17 metric is com-
tomic landmarks or implanted or externally placed fiducial           puted as the average squared intensity (IA and IB) difference
markers. The registration metric R is defined as the sum of          between Study A and Study B, where N is the number of vox-
the squared distances between corresponding points, where N          els evaluated.
is the total number of points;
         X                                                                          X
    R¼       ðpA0  pB Þ2 =N.                           (1)              SSD ¼       ðIA0  IB Þ2 =N.                                                (3)
   In Eq. (1), the summation is over the number of matched              In Eq. (3), the summation is over the number of voxels
points or surface points, N, and the division of the summation       evaluated, N, and the division of the summation by N is to
by N is to normalize the metric. To compute the rotations and        normalize the metric. This metric is simple to compute and is
translations for a rigid transformation, a minimum of three          effective for registering two imaging studies which have
pairs of points are required. For affine transformations, a          essentially identical intensities for corresponding anatomy,
minimum of four pairs of noncoplanar points are required.            such as serial or 4-D CT data.
   Alternatively, surface matching does not require a one to            An alternative technique is the use of the cross-correlation
one correspondence of specific points but rather tries to max-       (C)18–23 metric, which measures the similarity in the image
imize the overlap between corresponding surfaces extracted           signal. Rather than minimizing the intensity difference,
from two image studies, such as the brain or skull surface or        cross-correlation registration maximizes the intensity pro-
pelvic bones. The surfaces from Study B are represented as a         duct, as shown in 4A. The limitation of this metric is that it is
binary volume or as a polygon surface and the surfaces from          sensitive to the changes in the voxel value (increases in the
Study A are represented as a set of points sampled from the          intensity values of one image increases the cross-correlation).
surface. The metric, which represents the degree of mismatch
between the two datasets, can be computed as the sum or                         X
average of the squared distances of closest approach from the            C¼         ~
                                                                                    x
                                                                                          ~Þ  TðAðx
                                                                                        Bðx        ~ÞÞ                                             (4A)
points from Study A [pA’ in Eq. (2)] to the surfaces from               To overcome these limitations, the normalized version of
Study B (SB), where N is the number of points in Study A. It         the cross-correlation metric (correlation coefficient) can be
is written as                                                        used, which is shown in Eq. (4B). The assumption in the cor-
         X
   R¼         distðpA0 ; SB Þ2 =N,                         (2)       relation coefficient is that there is a linear relationship
                                                                     between the intensity values in each image, therefore, this
where dist(pA’, SB) computes the (minimum) distance between          metric can handle differences in image contrast and bright-
point pA’ and the surfaces SB. In Eq. (2), the summation is          ness in the image.
over the number of points, N, in Study A and the division of                         P
                                                                                            ðAðx             
                                                                                                  ~Þ  AÞðTðBðx             ~ÞÞ  BÞ     
the summation by N is to normalize the metric.                          CC ¼ P ~x
                                                                               q  ﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃﬃ
                                                                                                                                                    ﬃ (4B)
   As a surface matching technique, Chamfer matching is                                                      2P                                  2
                                                                                       ~       ~Þ
                                                                                       x ðAðx  AÞ                   ~            ~ÞÞ
                                                                                                                      x ðTðBðx  BÞ
statistically similar to correlation; however, it is simplified to

Medical Physics, 44 (7), July 2017
e48       Brock et al.: TG 132: Image registration                                                                                                              e48


    For data from different modalities where the pixel intensi-
ties of corresponding anatomy are typically (and inherently)
different, registration metrics based on simple differences or
products of intensities are not effective. In these cases,
sophisticated metrics based on intensity statistics are more
appropriate. When using these metrics, there is no depen-
dence on the absolute intensity values. One such metric that
has proven very effective for registering image data from dif-
ferent modalities is called mutual information (MI).24–43
Mutual information seeks to align voxels whose values have                                     FIG. 2. Basic mechanics of image registration algorithms.
common probabilities of being present in their respective
image sets. In Eq. (5), the summation is over the intensity
levels in image A’ (IA’) and Image B (IB), where p(IA’) and p                        the transformation depends on the form of T, which in turn
(IB) are the probability distribution functions of the intensities                   depends on the anatomical site, clinical application, and the
IA’ and IB, respectively and p(IA’, IB) is the joint probability                     imaging modalities involved. The transformation Τ can be
distribution function.                                                               simple, representing a rigid body, consisting of three transla-
                                                                                     tion and three rotation parameters (referred to as rigid regis-
                     XX                                                              tration). This can be expanded to nine or twelve parameters
   MIðIA0 ; IB Þ ¼               PðIA0 ; IB Þ log2 ½pðIA0 ; IB Þ=pðIA0 ÞpðIB Þ      to account for affine transformation (e.g., accounting for scal-
                        B    A
                                                                                     ing, shearing, and plane reflection). The transformation can
                                                                           (5)       also be spatially variant where the number of degrees of free-
   Commonly used similarity metrics are listed in Table I.                           dom can be as large as three times the number of voxels in
                                                                                     the source dataset (e.g., a unique displacement vector for
                                                                                     every voxel in the source dataset), referred to as deformable
2.C. Nature of transformation                                                        registration. Typically, these spatially variant vector fields are
   Image registration algorithms require four components: a                          constrained by a regularization function to ensure that they
geometric transformation T, a registration metric (described                         represent an anatomical and physiologically realistic transfor-
above in B), an optimizer (described below in F) which drives                        mation. A regularization function is used to restrict unrealis-
the algorithm to find the best result of the registration metric                     tic motion and to generate a smooth deformation field (i.e.,
such as maximization of mutual information between A’ and                            classifying a region as bone and restricting the degree of
B, as illustrated in Fig. 2, and finally image resampling and                        deformation in this region). Commonly used image registra-
application of the transformation.                                                   tion transformation algorithms are listed in Table II, orga-
   The fundamental task of image registration is to find the                         nized by class of transformation: those that have a physical
transformation T. The transformation T is applied to the mov-                        basis for the transformation and those that are a geometric
ing image (Study A) to align it to the stationary image (Study                       construct. The registration matrix resulting from a deform-
B). In general, this transformation can be written as                                able registration is often referred to as a deformation vector
                                                                                     field, as there can be a unique 3D transformation for each
   XB ¼ TðXA ; fbgÞ                                                        (6)       image voxel.
where XA is the coordinate of the point in the moving dataset                            Ideally the transformation T is invertible, but that is not
A, XB is the coordinate of the same anatomic point in the sta-                       always the case in complex cases (tissue that is only present
tionary dataset B, and {b} is the set of parameters of the                           in 1 of the images) or for transformations that are not well
transformation. The output of the image registration process                         behaved (e.g., the transformation is significantly different
is the parameters {b} for a particular pair of imaging studies                       when mapping A to B and B to A). Therefore, the user must
(Fig. 2). The number of the parameters required to determine                         consider the purpose of the registration and how the


TABLE I. Similarity metrics.

Class                                       Metric                                                            Description

Voxel intensity-based       Sum of the squared difference (SSD)      Assumes an equivalent relationship between voxel intensities in 2 images, single modality
                            (Mean squared difference, MSD)
                            Correlation coefficient (CC)             Assumes linear relationship between voxel intensities in 2 images, single modality or possibly
                                                                     small region of multimodality
                            Mutual Information (MI)                  Assumes statistical relationship between voxel intensities in 2 images, single or multimodality
Feature-based               Point-based                              Assumes direct relationship between points identified on 2 images, single or multimodality
                            Contour-based                            Assumes direct relationship of identified boundaries of regions of interest in 2 images, single
                                                                     or multimodality



Medical Physics, 44 (7), July 2017
e49        Brock et al.: TG 132: Image registration                                                                                                        e49


TABLE II. Commonly used transformation models. (N = number of voxels in an image).

                                                                      Maximum dimensionality of
Class                           Transformation                             transformation                                 Description

Geometric    Rigid                                                               6                Allows translation in 3 directions and rotations about 3 axes
             Affine                                                              12               In addition to translation/rotation, allows uniform scaling
                                                                                                  and sheer (e.g., parallel lines stay parallel)44–48
             Free-form                                                           3N               Local, voxel-based deformation, often regularized by a
                                                                                                  smoothing parameter
             Global spline-based methods (e.g., thin plate splines)              3N               Parameterizes deformation using a parametric grid of basis
                                                                                                  function control points with constrained global influence
                                                                                                  (e.g., deformation is global)34,49–66
             Local spline-based methods (e.g., B-spline)                         3N               Parameterizes deformation using a weighted grid of control
                                                                                                  points of basis functions with local influence
                                                                                                  (e.g. deformation is local)17,67–101
Physical     Viscous/elastic/optical flow (e.g., demons)                         3N               Spatially variant voxel displacement voxel displacement by
                                                                                                  a vector field in a deforming medium, by intensity gradients
                                                                                                  (deformation is local)102–110
             Finite element methods (FEM)                                        3N               Spatially variant voxel displacement voxel displacements
                                                                                                  governed by biomechanical tissue properties
                                                                                                  (deformation is local)55,92,111–135




transformation will be used to determine which direction the                      algorithms are used from gradient-based methods that
transformation should be generated.                                               employ the gradient of the similarity metric with respect to
                                                                                  the transformation parameters to best choose search direc-
                                                                                  tions to more stochastic methods that randomly sample the
2.E. Interaction
                                                                                  search space in a controlled fashion. Another important
   It is prudent to acknowledge the role of the user in image                     attribute of the optimizer is in how it manages parameter
registration. The registration can be interactive, semiauto-                      constraints. For example, in deformable image registration,
matic, or completely automated. Image registration can be,                        a smoothness constraint may be applied to ensure that a
and has been for many years, performed either completely                          deformation map does not contain any high frequency
manually or with manual intervention. The role of the user                        deformations that are unrealistic. To do this, the transforma-
may be to provide an initial registration when two images                         tion parameters themselves will be constrained, and the
have a substantial (i.e., several cm) shift or to adjust the out-                 optimizer has to be able to handle these constraints without
put of the image registration when the user does not feel that                    generating instabilities in the overall optimization process.
an optimal solution has been found. The manual adjustment                         Several such considerations are important to the optimiza-
of the registration following automated registration should be                    tion and are dependent on the type of transformation and
restricted to rigid registration. The direct, unguided manual                     parameter constraints being used. It is important to under-
adjustment of a deformation vector field is not recommended                       stand the optimization approach used by your clinical solu-
and could lead to erroneous results that are not obvious, how-                    tion to better appreciate how it converges and where it may
ever iterative refinement or principled adjustment may aid in                     have pitfalls.
achieving a realistic and more accurate registration.
                                                                                  2.G. Modalities involved
2.F. Optimization procedure
                                                                                      Image registration for radiotherapy applications often
   A myriad of optimization methods are used in rigid and                         involves several different imaging modalities including CT,
deformable registration algorithms.136–146 The goal of the                        PET, SPECT, MR, ultrasound, CBCT, an MVCT. Image reg-
optimization is to find the best set of parameters of the                         istration can therefore be between two images of the same
transformation to obtain the best image alignment given by                        modality or between images of different modalities.
the similarity metric. For image-based similarity metrics
most optimizers are iterative in nature and will repeatedly
                                                                                  2.H. Subject
try different transformation parameters until the resulting
value of the similarity metric converges to an optimal                               Image registration can also be performed between images
value. The primary goal of the optimizer is to be efficient                       of the same subject, between images of different subjects, or
by intelligently finding search directions through the                            between an atlas and an individual patient. Image registration
parameter space while also searching the entire parameter                         between images of the same subject is most common in
space to find the most accurate solutions. Several                                radiotherapy; however, between images of different subjects

Medical Physics, 44 (7), July 2017
e50     Brock et al.: TG 132: Image registration                                                                                e50


can be useful to characterize disease or motion across a popu-          than that of CT or MR studies and can lead to signifi-
lation. Registration between patient images and an atlas can            cant resizing and resampling which in turn can affect
also be performed for segmentation purposes.                            the values of reconstructed voxels.
                                                                      • Quality: Images of some registered studies can be noisy
                                                                        and of poor quality (by design, e.g., to limit dose, or
2.I. Limitations and challenges
                                                                        due to confounding factors, e.g., motion during scan-
    Restricting the registration of two images to simple rigid          ning) leading to a difference in the appearance of
transformations is often met with remaining uncertainties due           images being registered.
to the deformable nature of soft tissue. However, at the pre-
sent time, the majority of radiotherapy clinics are limited to         The above examples demonstrate the natural variability
rigid registration at treatment planning and delivery. In these    and possible alterations of imaging studies being registered.
cases, the user should make tradeoffs to optimize the registra-    Due to the potential and unpredictability of imaging data, it is
tion in a way that reduces the uncertainties in the most impor-    important to evaluate the appearance of registered studies as
tant regions for the task and account for the uncertainties as     well as the registration accuracy for each individual registra-
appropriate for the clinical care.                                 tion. Solutions to address these issues will vary based on
    Even when deformable registration is available for use,        extent of the image alteration, options available in the regis-
limitations and challenges remain. Regardless of which algo-       tration system, and the subsequent use of the registered
rithm is chosen, deformable registration is ill-defined and        image.
over-constrained. All algorithms use a model to describe the
deformation and as a result will have limitations. For exam-
                                                                   3.B. Sources of error in registration
ple, many deformable registration algorithms assume
smoothness of the vector field. This expectation will lead to          The process of registration can introduce uncertainties, so
registration error when singularity of the vector field exists,    it is therefore important that quality assurance and quality
such as when registering an open mouth to a closed mouth,          control techniques are designed to understand, evaluate,
an image with a vaginal applicator to one without, or when         reduce, and account for these uncertainties. Sources of error
registering two images where a structure is present in one and     can generally be divided into input, algorithm, and output.
not in the other. The large numbers of degrees of freedom in           Uncertainties in the images, the input to the registration,
deformable registration may lead to ambiguity in the defor-        can cause error in the image registration. Artifacts are a com-
mation vector field for some algorithms, such as areas with        mon source of uncertainties in images. Image artifacts can be
very low tissue contrast and registration in these areas can be    due to the anatomy (such as dental fillings or stents) or
prone to inaccuracies.147,148                                      motion (e.g., breathing, peristalsis, heartbeat). These image
                                                                   artifacts limit the geometric fidelity of the image by present-
                                                                   ing inconsistent anatomy and can lead to errors in the regis-
                                                                   tration. Artifacts in the image due to acquisition (e.g., MR
3. CLINICAL ISSUES AND APPLICATIONS OF
                                                                   distortion, lack of calibration of the imaging equipment) can
IMAGE REGISTRATION IN RADIOTHERAPY
                                                                   also cause errors in the registration. Care should be taken to
3.A. Sources of error due to data acquisition                      calibrate the imaging equipment, select the most optimal
                                                                   imaging parameters for acquisition, and avoid anatomy-based
   The extent, scan parameters, and the quality of individual
                                                                   artifacts. Other information in the images that are not artifacts
imaging studies can affect the accuracy of their registration
                                                                   can be a source of error, such as large changes in the anatomy
with other studies.
                                                                   between images (e.g., response to therapy or weight loss).
   • Extent: A potential complication exists when the physi-       Large changes in the tissue especially in areas that lack infor-
     cal extent of two studies to be registered are signifi-       mation (e.g., features and contrast variation) can be especially
     cantly different, leading to limited volumes available for    prone to errors in the registration.
     registration and evaluation of its accuracy. The limited          The image registration algorithm can also be a source of
     extents are typically in patient’s cranio-caudal direction,   error. Optimal selection of the main algorithm components,
     where one study is shorter than the other, but with MR        e.g., similarity metric, transformation model, and optimizer,
     acquisitions, the limited extent can be in all directions,    can aid in mitigating these errors. Using too many or too few
     particularly with nonaxial plane acquisitions.                degrees of freedom can cause errors in the algorithm. Poorly
   • Scan Parameters: Scan parameters of the registered            designed optimizers can result in the algorithm finding a
     imaging studies affect the integrity (sampling/resam-         solution in local minima instead of the global minima. Uncer-
     pling effects) and the size of their voxels (resolution).     tainties in the selection of features or the manual contouring
     The voxel integrity can be a problem with MR studies          of structures that drive the registration can also be a source of
     where images acquired in oblique volumes with rectan-         error. Limitations in the model used for the registration can
     gular voxels need to be significantly manipulated and         cause errors, such as the inability to handle tissue interfaces
     resampled to match the axial orientation of the CT            that are sliding (e.g., the lung sliding along the rib cage) or
     study. Spatial resolution of PET images can be lower          tissue loss or gain (e.g., weight loss/gain or tumor response).

Medical Physics, 44 (7), July 2017
e51       Brock et al.: TG 132: Image registration                                                                                                           e51


Models with limited capabilities can introduce error when                               The goal of the reformatting and interpolation is to create
registering images that show complex changes.                                       a version of Study A (Study A’’) with images that match the
   Finally, the use of the registration, the output, can be a                       size, location, and orientation of those in Study B. The voxel
source of error. Incorrect interpolation of the registration                        values for Study A’’ are determined by transforming the coor-
results can cause error as well as improper extrapolation of                        dinates of each voxel in Study A using the appropriate regis-
the registration field of view. Invalid use of the registration                     tration transformation (producing Study A’) and interpolating
results can also be a source of error for downstream pro-                           between the surrounding voxels and reformatting to match
cesses, such as contour propagation, dose accumulation, or                          Study B (producing Study A’’). The result is a set of images
image guidance.                                                                     from the two studies with the same effective scan geometry.
                                                                                    These corresponding images can then be combined or fused
                                                                                    in various ways to help elucidate the relationship between the
3.C. Image registration for segmentation
                                                                                    data from the two studies or enable delineation of anatomy on
   One motivation for registering imaging studies is to be                          the fused images, including the use of overlays, pseudo-color-
able to map information derived from one study to another                           ing, and modified grayscales. For example, functional infor-
(e.g., for image segmentation) or to directly combine or fuse                       mation from a PET imaging study can be merged or fused
the imaging data from the studies to create displays that con-                      with the anatomic information from an MR imaging study
tain relevant features from each modality. For example, a ref-                      and displayed as a colorwash overlay.
erences image, with all relevant anatomy, can be registered to                          In addition, 3D dose distributions computed in the coordi-
a patient-specific image, and the contours can then be copied                       nate system of one imaging study can be mapped to another
onto the patient-specific image. In another example, a tumor                        (e.g., doses computed on the treatment planning CT can be
volume more clearly visualized using MR can be fused with                           displayed on an MR).
the CT used for treatment planning. If the geometric transfor-
mation between the MR study and the treatment planning CT
                                                                                    3.D. Image registration for multimodality or
study is known, the clinician is able to outline the tumor on
                                                                                    adaptive treatment planning
the MR and map these outlines to the CT for planning. This
process is called structure mapping and is illustrated in                              Image registration is necessary when integrating multi-
Fig. 3. This process can also be performed between two                              modality images (e.g., CT, MR, PET, and/or CBCT) into
images for the purposes of propagating the set of contours on                       treatment planning and plan delivery. The necessary output
one image to the other image.                                                       of this registration is a transformed image that is in the same
   If the registration involves rotation and translation, the                       geometric position as the reference image. The use of multi-
contours from the secondary image cannot be directly over-                          instance imaging (e.g., inhale and exhale CT) may also
laid onto the primary as the image slices do not align. A sur-                      require registration to obtain the motion and/or deformation
face representation of the target volume can be constructed                         that is exhibited by the tumor and surrounding critical struc-
by tessellating or “tiling” the 2-D outlines. Using the com-                        tures for incorporation into the planning process and dose
puted transformation, the vertices of the surface are mapped                        calculation. In this case, it is the transformation, rather than
from the coordinate system of the secondary image to the                            the transformed image, that is needed.
coordinate system of the primary image. The transformed sur-                           The complexity of the multimodality image registration
face can be inserted along the image planes of the primary                          depends on the complexity of the variations in anatomy,
study. The result is a set of outlines of the secondary image                       including motion and anatomical changes, between the imag-
defined structure that can be displayed over the primary                            ing sessions or acquisitions. In some instances, the imaging
images. These derived outlines can be used in the same man-                         hardware can be joined (i.e., a PET-CT scanner, SPECT-CT,
ner as other outlines drawn directly on the primary images.                         or PET-MR). This does not guarantee perfect alignment,




FIG. 3. Structure Mapping. (a) Tumor volume outlined on a secondary image (e.g., MR in this case). (b) Outlines stacked and tessellated to create a surface repre-
sentation.149 (c) The MR-based surface is mapped to the CT coordinate system and resliced along the image planes of the CT study. (d) The derived contours are
displayed over the CT images. [Color figure can be viewed at wileyonlinelibrary.com]


Medical Physics, 44 (7), July 2017
e52     Brock et al.: TG 132: Image registration                                                                                e52


however, as physiological processes (bladder filling, breath-       The influence that the user has on the location of this point is
ing, peristalsis, etc.) occur between the acquisitions, as well     determined by the design of the algorithm and should be
as the possibility of small patient movements.                      investigated by the user prior to using these tools. With
    When the imaging hardware is not combined, some of this         advanced treatment hardware, such as a 6 DOF couch, the
complexity can be reduced in multimodality imaging by tak-          measured rotations can then be corrected for by rotating the
ing steps to maintain the same patient configuration between        couch. However, if a 6 DOF couch is not available, the user
imaging sessions (i.e., use the same immobilization device,         can choose between rotating the table to correct for 1 rota-
minimize the time interval between the acquisition of the           tional DOF, which is typically possible with most standard
images to reduce certain physiological motions such as blad-        equipment, or the user should determine how to best account
der and stomach filling). By taking these steps, it may be pos-     for the rotations with only a 3 DOF translation. Murphy pro-
sible to use a simple image registration technique (e.g., rigid     vided an excellent technical comment addressing this issue,
registration or rigid registration on a limited field of view) to   which the reader is referred to for further information.151
achieve an acceptable accuracy. However, some issues cannot
be addressed through imaging protocols, such as the soft tis-
                                                                    3.F. Image registration for response assessment
sue deformation that occurs due to breathing motion, internal
organ distortion, and dramatic patient weight loss from plan-           The use of image registration to improve the assessment
ning to plan delivery, where, deformable image registration         of disease response is an active area of research at the time
may be required to achieve the desired level of accuracy.150        of this report. Image registration for response assessment
    In addition, image registration is a useful tool to assist      can be performed during or following the completion of
with adaptive re-planning, where anatomical changes that are        radiation therapy. It is performed between images of the
observed over the course of treatment require a modification        same or different imaging modalities and the goals often
to the treatment plan to maintain the targeted therapeutic          differ from those for treatment planning or guidance. As the
intent and the normal tissue sparing. The complexity that           name indicates, the registration is performed to enable quali-
exists between the initial planning images and the image            tative or quantitative evaluation of the response of the tumor
acquired for adaptive replanning cannot be resolved by con-         or normal tissue to radiation. Standard response metrics,
sistent immobilization as it is the shape, size, and position of    such as Response Evaluation Criteria in Solid Tumors
the anatomy that has changed. Deformable registration pro-          (RECIST),152 perform simple 2D measurements of the
vides the ability to account for these changes and link these       tumor in its largest dimension. While these techniques are
two instances of the patient together.                              simple and do not require registration, they also do not
                                                                    incorporate the heterogeous and complex response of
                                                                    tumors following irradiation. Response assessment in radio-
3.E. Image registration for image-guided
                                                                    therapy often requires a comparison of functional imaging
radiotherapy (IGRT)
                                                                    or analysis of soft tissue imaging beyond the RECIST crite-
   Image registration for IGRT is performed primarily to            ria, which requires image registration. These cases challenge
guide patient positioning for individual treatment fractions.       image registration algorithms due to changes in the volume
Therefore, the necessary output of the registration, whether        and mass of the tissue of interest as well as large deforma-
the registration is simple (e.g., rigid) or complex (e.g.,          tion in tissues. When deformable registration is performed
deformable), is a numerical transformation that will best align     between two longitudinal images, the magnitude of response
the patient at the time of treatment to the representation of       can be evaluated from the deformation vector field. In addi-
the patient at the time of planning with respect to the treat-      tion, the complexity of the tumor and normal tissue
ment isocenter. The resulting transformed image may also be         response can also be characterized by the deformation.153
used in image fusion for verification of the registration.
   In addition, complex anatomical changes may occur
between planning and the treatment fraction, including              4. METHODS FOR VALIDATION AND QUALITY
changes in the physiological state (e.g., bladder/stomach fill-     ASSURANCE
ing), changes in the gross patient position (e.g., neck flex-
                                                                    4.A. General concepts
ion), or response of the tumor or normal tissue to treatment
(e.g., tumor volume reduction). The identification of these            It is important to clearly identify the terminology used to
changes can be facilitated through image fusion at the treat-       describe the assurance of quality image registration. The fol-
ment fraction.                                                      lowing definitions will be used for this task group report,
   Both the measurement and the implementation of the mea-          consistent with the formal US Food and Drug Administration
sured correction are governed by the system and tools clini-        (FDA) definitions.
cally available. Some IGRT-based registration systems allow            Validation refers to the evaluation of the overall process
for the measurement of patient rotation in either one or all        and toolset to ensure that accurate image registration can be
three imaging planes. It is important to note that the measured     performed on a consistent basis for the intended use (e.g.,
rotation is impacted by the selection of the point of rotation.     contouring, image guidance, etc.).


Medical Physics, 44 (7), July 2017
e53      Brock et al.: TG 132: Image registration                                                                                                      e53


    Verification is the process of confirming that the accuracy                  images, data integrity (i.e., the validity of the interpretation of
of a specific image registration is acceptable for the intended                  the image data into a visual image), and registration verifica-
use (e.g., is the registration of the patient’s MR and CT                        tion should be performed during each step of image process-
accurate).                                                                       ing and registration and should be the responsibility of the
    Quality Assurance is the procedures and process followed                     entire radiotherapy team. The scope of the verification tests
to ensure maintenance of quality in each image registration.                     will depend on the registered imaging modalities, capabilities
    Image registration errors can stem from multiple factors                     of the registration system, and the clinical purpose of image
such as image distortions, inability to reproducibly select                      registration. The achievable accuracy also depends on the
fiducial points represented in both image sets to be registered,                 images being registered, their associated voxel size, the
registration algorithm limitations, incorrect selection of regis-                degrees of freedom of the registration algorithm, and of
tration algorithm parameters, etc. The ability to accurately                     course, the amount of deformation between the two images.
assess registration errors partially depends on the tools pro-
vided in the image registration software and the ability of the
                                                                                 4.B. Qualitative validation and veriﬁcation of image
user to interact with the registration results. Other considera-
                                                                                 registration accuracy
tions include spatial distortions (e.g., MR distortion) as well
as the final clinical endpoint for evaluated images. The over-                       For initial commissioning of an image registration system,
all image registration accuracy for the majority of clinical                     quantitative validation is required; however, for patient-speci-
applications, where an in-plane resolution is ~1 mm and slice                    fic evaluation of image registration, quantitative verification is
thickness is ~2–3 mm, is typically desired to be within                          not always possible due to limited time and resources and dif-
2 mm. Therefore, the registration evaluation process has to                      ficulty in determining the ground truth. In routine clinical
be able to support this accuracy and evaluation tools need to                    practice, qualitative verification of image registration should
be able to detect registration errors in individual directions                   be performed to ensure acceptability of the registration. Com-
that are smaller than the composite error.                                       mon techniques used to enable qualitative evaluation are
    The tools needed for registration validation and verifica-                   described and illustrated below in Fig. 5. These techniques
tion depend on the evaluation method. Software packages                          often rely on the visualization of image fusion.
used for image registration in radiotherapy should support                           Once the optimal transformation between a stationary
the methods described in section 4. Independent validation                       source and moving target dataset is determined (through the
of an application requires access to the geometric transfor-                     identification of the maximum value of the similarity metric),
mation. To facilitate this, the software should allow access                     data from the moving dataset can be mapped to the stationary
to and export of the registration matrix or deformation vec-                     dataset and combined or displayed on or with the stationary
tor field following registration. This export should ideally                     dataset. This process is called fusion. An example is shown
be in Digital Imaging and Communication in Medicine                              in Fig. 4.
(DICOM) format, but at minimum in a well-described,                                  These displays allow the individual to select the color
easily accessible format. The choice of evaluation method                        mapping, window and level and color blending methods that
used for validation and verification depends on the specific                     best visualize the fused image sets. The appropriate use of
use of registered images as well as on the registered imag-                      window/level in both images is critical for these assessments,
ing modalities.                                                                  using different levels to visualize different aspects of the
    While the registration should be ultimately approved by a                    anatomy. Inadequate display settings can blind the user to
trained member of the radiotherapy team prior to use of                          otherwise obvious errors in registration. Appendix A




FIG. 4. An FDG PET image and a CT image, originally not aligned, underwent image registration (center) and image fusion (right). [Color figure can be viewed
at wileyonlinelibrary.com]


Medical Physics, 44 (7), July 2017
e54       Brock et al.: TG 132: Image registration                                                                                             e54


                                                                                color maps and the fraction of reference and floating image
                                                                                in the blended display.

                                                                                4.B.3. Difference image displays
                                                                                    Difference image displays are useful for intramodality visu-
                                                                                alization of registration accuracy (e.g., CT/CT, MR/MR). The
                                                                                display is created by subtraction of coregistered voxel intensi-
(a)                            (b)                                              ties. If the absolute value of the difference is used, a perfect
                                                                                intensity match at the voxel level leads to a display level of 0
                                                                                (black); as the mismatch gets worse, the color displayed for
                                                                                the voxel gets brighter, approaching white. The utility of these
                                                                                displays in the clinical setting is limited as they are very sensi-
                                                                                tive to the exact voxel values of the registered datasets.

                                                                                4.B.4. Contour/structure mapping displays
(c)                            (d)
                                                                                    Contour overlays as shown in Figs. 5(b) and 5(c) are use-
                                                                                ful for multimodality image registration. Anatomical contours
                                                                                defined on one imaging modality can then be overlaid, in the
                                                                                same spatial location, on the second imaging modality. Quali-
                                                                                tative assessment of correlation of the contour to the anatomy
                                                                                on the secondary image can aid in validating the registration
                                                                                results, although this must be interpreted in the context of the
                                                                                visibility of the anatomy.155,156
            (e)

FIG. 5. (a) Image–image visual validation using split screen displays of
native MR and reformatted CT study. (b) Region of interest delineation over-    4.C. Quantitative measures of image registration
laid on a fused PET and CT. Contoured are target volumes as identified on       accuracy
PET image and pelvic and vertebral bones as delineated on CT images. (c)
Image geometry visual validation structure overlay of CT defined brain outli-   4.C.1. Target registration error
nes over MR images. (d) Side-by-side display with linked cursor. (e) Differ-
ence image showing good registration (e.g., solid blue) within the liver, the      The alignment of anatomical points is a simple and direct
area of interest, and more uncertainty in the bone and surface (e.g., yellow,   way to quantify the accuracy of registration at a specific loca-
green, red color). [Color figure can be viewed at wileyonlinelibrary.com]       tion. Increasing the number of points improves the validity of
                                                                                the verification for the overall image registration. The tech-
provides a table with site-based guidance of anatomical struc-                  nique is simple in theory, a set of landmarks for correspond-
tures to use for validation of registration.                                    ing anatomic points are identified on Studies A and B and the
                                                                                distance between the actual location of the points defined on
                                                                                Study B and the resulting transformed locations of the points
4.B.1. Split screen and checkerboard displays
                                                                                from Study A’ is computed. This is often referred to as the tar-
    Split screen, floating window (i.e., a window on Study B                    get registration error (TRE), which is the average residual
that shows Study A’), and checkerboard displays as shown in                     error between the identified points on Study B and the points
Fig. 5(a) are the most commonly used form of qualitative                        identified on Study A, mapped onto Study A’ through image
visualization tool for detecting registration error in the clini-               registration.157 A ‘perfect’ registration at the location of the
cal setting. They are particularly effective in identifying mis-                landmark would result in the landmark being in the exact
matches between corresponding structures at high contrast                       same spatial location in both Study A’ and Study B, resulting
tissue interfaces. The split screen partition and checkerboard                  in a TRE of 0. In practice, it may be difficult to accurately
locations are typically a user-controllable aspect of these                     and sufficiently define the appropriate corresponding points,
displays.154                                                                    especially when registering multimodality data. There will
                                                                                always be some degree of uncertainty in the location of the
                                                                                corresponding landmarks identified in each image, resulting
4.B.2. Image overlay displays
                                                                                in a non-zero distance between the landmark identified on
   Image overlay displays as shown in Fig. 5(b) produce                         Study A and Study B’, even after the highest quality image
images that are the blended composition of registered images.                   registration. Studies have shown that the uncertainty in point
Often the reference image is presented in gray scale color                      selection is typically less than the voxel size.34,116 Also, if
map and the floating image is presented in a color scale. The                   deformations are involved, the evaluation is not valid for
user is typically able to control the choice of grayscale and                   regions away from the defined points.

Medical Physics, 44 (7), July 2017
e55     Brock et al.: TG 132: Image registration                                                                               e55



4.C.2. Mean distance to agreement and dice                         4.C.3. Jacobian determinant
similarity coefﬁcient
                                                                       Mathematical functions are less commonly used to quan-
    The alignment of anatomy or features (e.g., stents) delin-     titatively evaluate image registration, often because their
eated on Study B overlaid onto Study A’ can provide a quali-       interpretation is less clear. The Jacobian determinant can be
tative assessment of the accuracy of registration. By              calculated following a deformable registration between two
contouring the same structure on Study A’, a quantitative          images and evaluated. The Jacobian determinant identifies
assessment of the accuracy can be obtained. Under perfect          the local volume change as a result of the registration. Jaco-
registration (and perfect delineation), the contour of the anat-   bian determinants greater than 1 indicate volume expansion,
omy on Study B should perfectly match the contour on Study         between 0 and 1 indicate volume reduction, a value of 1
A’. In practice, they will not perfectly match due to contour      indicates no change, and a value of less than or equal to 0
variation. Contour variation depends on the imaging modality       indicates nonphysical motion (e.g., regions of the image
and structure of interest. For example, Persson et.al. quanti-     folded onto itself). A Jacobian determinant of less than or
fied the interobserver delineation variation to be 2.6 mm for      equal to zero clearly indicates an erroneous physical model-
SBRT of peripheral lung tumors using a cross-sectional study       ing of the patient and may indicate an error in the registra-
design,158 while Brouwer et al. reported a 3D variation about      tion or a limitation in the algorithm to handle complex
3.9 mm in delineation of glottis larynx from head-and-neck         deformation. Any negative values indicate an error in the
cancer patients.159 Interobserver variation is typically larger    registration and these areas should be carefully evaluated for
than intraobserver variability,158–160 so when evaluating the      their influence on the results and further applications of the
accuracy of a registration, having the same observer contour       registration. However, some volume expansion and contrac-
the structure on both images will reduce the uncertainty in        tion is expected in some registrations (e.g., registering an
the metric.                                                        inhale to exhale lung). Large local changes in the Jacobian
    However, the discrepancy between the contours should           determinant could also indicate a registration error (e.g.,
be within the variation of the observer contouring. Quantita-      voxels in a small 2 9 2 region with a Jacobian of 10 while
tive comparison between the contours can be performed              surrounding voxels have a Jacobian of 1).
using multiple metrics. Two commonly used approaches are               Additionally, the metrics used to drive registration (i.e.,
the Dice similarity coefficient (DSC)161 and mean distance         SSD, CC, and MI) can also be used to assess the registration
to agreement (MDA),162 also referred to as the mean dis-           as long as the metric was not used in the registration algo-
tance to conformity. DSC is defined as two times the vol-          rithm itself. These metrics can be easily and efficiently
ume where the two contours overlap divided by the total            employed to assess the registration. However, it is difficult to
volume of both contours combined. As the contours                  convert these metrics into quantitative measures of spatial
approach agreement, the DSC value approaches 1; as the             accuracy.
volumes diverge into two nonoverlapping structures, the
DSC value goes to 0. At the time of publication, the calcu-
                                                                   4.C.4. Consistency
lation of DSC in commercially available registration systems
is not standard, although its inclusion in commercial soft-            In addition, quantitative metrics of consistency can be
ware is a recommendation of this report. However, it is            performed. These do not provide direct verification, but do
often possible for the user to calculate this using Boolean        provide evidence of a stable and well understood system.
operators typically available. Given a structure image B           These techniques include performing the registration in both
(struct_B), the same structure contoured on image A                directions to ensure that the registration is inverse consis-
(struc_A), and the mapping of struct_A onto Image B                tent, i.e., registering A to B and then B to A. The registra-
through image registration (resulting in image A’ and              tion should be consistent in magnitude but opposite in
struct_A’ both in the geometrically registered space of            direction. When multiple images are to be registered, transi-
Image B) the DSC could be computed as follows: 2*                  tivity can be measured by performing the registration of A
(struct_A’ AND struct_B)/(struct_A’ OR struct_B). To com-          to B and combining this with the registration results of B to
pute the mean distance to agreement, contour B would be            C. This combined registration result should be the same as
converted into a series of points and the distance of each         the registration of A to C.
point to contour A’ would be computed. Contour A’ would                The quantitative metrics are summarized in Table III.
then be converted into points and the distance of each point       As with the qualitative metrics, the tolerance listed is the
to contour B would be computed. The average of all dis-            target tolerance for the registration. The multidisciplinary
tances would then result in the mean distance to agreement.        team, including the physicist and physician, should evalu-
As with DSC, MDA is not a standard feature in commercial           ate if additional uncertainty beyond the tolerance should
registration, but recommended for inclusion. Using the same        be added to the uncertainty margin for the patient. This
structure definition described for DSC, the user can estimate      will depend on the clinical protocol. Tolerances listed are
the MDA by manually measuring distances between                    also for standard treatment, stereotactic radiosurgery toler-
struct_A’ and struct_B and calculating the average of these        ances are 1 mm, corresponding to the smaller voxel
differences.                                                       dimension.

Medical Physics, 44 (7), July 2017
e56       Brock et al.: TG 132: Image registration                                                                                                                e56


TABLE III. Quantitative metrics to evaluate image registration.

Technique                                                         Evaluation metric                                                    Tolerance

Target registration error (TRE)            Point-based accuracy metric using implanted or naturally                Maximum voxel dimension (~2–3 mm)
                                           occurring landmarks visualized on a pair of images
Mean distance to agreement (MDA)           Mean surface distance between 2 contours on registered images           Within the contouring uncertainty of the structure
                                                                                                                   or maximum voxel dimension (~2–3 mm)
Dice similarity coefficient (DSC)          Volumetric overlap of 2 contours on registered images                   Within the contouring uncertainty of the structure
                                                                                                                   (~0.80–0.90a)
Jacobian determinant                       Volume expansion or contraction resulting from a deformable             No negative values, values deviating from 1 as
                                           image registration                                                      expected from clinical scenario (0–1 for structures
                                                                                                                   expected to reduce in volume, greater than 1 for
                                                                                                                   structures expected to expand in volume)
Consistency                                Independence of an algorithm to the direction of the registration       Maximum voxel dimension (~2–3 mm)
                                           (image A to image B or image B to image A)

a
 DSC calculations are dependent on the volume of the structure, therefore very large or very small structures may have different expected DSC values for contour uncer-
tainty.




                                                                                      classifications can be made based on imaging modality com-
4.D. Speciﬁc considerations of phantoms
                                                                                      patibility of individual phantoms. It is ideal to have a single
    During commissioning of an image registration system,                             phantom that is compatible with all the imaging modalities,
phantoms can also be very useful to quantitatively assess the                         which may be used for treatment planning of an individual
accuracy of image registration. Phantoms can be physical                              patient. The final classification is based on image registration
(tangible objects and their images can be acquired on various                         characteristics that can be evaluated with a specific phantom.
scanners) or virtual (digital). For physical phantoms, the                            Generally, no single phantom is suitable for testing image
unambiguous landmarks (e.g., implanted fiducial markers)                              data integrity, spatial integrity (i.e., accurate dimensions of
within the image can be mathematically erased (i.e., replacing                        the voxels and overall image), quality integrity (i.e., accurate
the high contrast voxel values of the landmark with the aver-                         display of the voxel values), orientation (i.e., pose of the
age voxel intensity of the surrounding voxels) to reduce the                          patient), chirality (i.e., left–right designation in the presence
bias of the image registration algorithm resulting from the                           of symmetry), registration accuracy, deformation integrity,
focus of the registration on that high contrast object. A bene-                       and various other system functionalities.
fit of physical phantoms is that they can be used to test the                            As CT is the primary imaging modality in RT, it is conve-
entire image registration process, including image acquisition                        nient that all phantoms are compatible with CT and the whole
with possible distortion and noise, data transfer and import,                         phantom including the shell and contents can be imaged
and image registration. This process is representative of the                         without any contrast agents. MR, PET, and SPECT require
actual process that is used for patient imaging and image                             specialized phantoms that can be filled with contrast agents
registration.                                                                         and often also require fiducial markers. Test objects con-
    Virtual phantoms are created or modified from patient                             tained in these phantoms can also be filled with contrast
images in software. As such, virtual phantoms can be used to                          agents (with typically different concentration than the back-
test only the image registration process. In many situations, it                      ground) or can just be solid objects. In many situations, these
is desirable to have phantom images with precisely known                              phantoms can be designed so they are compatible with all
translations and rotations. Introduction of exact rotations and/                      three imaging modalities: MR, PET, and SPECT. However,
or translations in virtual phantoms is simple to apply and                            PET and SPECT phantoms present unique challenges due to
extremely precise. Also, for digital phantoms, increasing                             radioactive contrast agents and multimodality imaging of
complexity can be generated by adding noise to the image to                           these phantoms requires careful planning.
simulate the realistic variation between image sets.                                     Ultrasound phantoms are highly customized and can be
    Both virtual and physical phantoms offer certain advan-                           compatible with CT and/or MR. Certain clinical applications
tages and are useful for testing of image registration software                       require image registration of US and MR images as well.
and processes. Phantoms can be classified as rigid or de-                             Such phantoms can be created and generally perform very
formable and are used to evaluate the respective registration                         well.
algorithms. For rigid registration, either physical phantoms                             Also, either virtual or physical phantoms used for evaluat-
(imaged, adjusted by a known amount, and reimaged) or digi-                           ing image registration accuracy can be classified into two
tal (images that have a known displacement) phantoms can                              broad categories as geometrical (i.e., combinations of stan-
be used. For deformable registration, physical phantoms                               dard shapes) or anthropomorphic (i.e., representing human
(with unambiguous points) and digital (images that have a                             anatomy). Well defined dimensions of geometric phantoms
known deformation field applied) can be used. Further                                 make them suitable for testing the spatial integrity of image

Medical Physics, 44 (7), July 2017
e57     Brock et al.: TG 132: Image registration                                                                                  e57


registration processes, especially when coordinate transfor-       minimum using qualitative assessment tools described in sec-
mation and voxel interpolation are involved. Geometric             tion 4.B. When registration of a second image is used to
shapes are generally easier to accurately position on an imag-     improve identification of the tumor, the user should evaluate
ing device and translate and rotate in precise increments. The     the registration accuracy of the tumor-bearing organ or
main advantage of anthropomorphic phantoms is that they            directly neighboring organs, especially in the case where the
have anatomical features. This is especially important for test-   tumor itself is not visible on one of the imaging modalities. If
ing the accuracy of registration algorithms. Use of geometric      the boundaries of the tumor-bearing or neighboring organs
phantoms for these situations may oversimplify the problem         are not well aligned (as quantitatively or qualitatively deter-
resulting in registration accuracy not obtainable in clinical      mined by the trained reviewer or clinician treating the
images. Digital anthropomorphic phantoms can be generated          patient), the uncertainty of the registration (assessed through
based on clinical images (e.g., by applying a known deforma-       quantitative or estimated through qualitative techniques)
tion to a clinical image) or based on, but independent from,       should be included in the PTV margin. For example, in the
clinical images (e.g., nonuniform rational b-splines               treatment planning of a liver tumor, if an MR image is being
(NURBS)-based cardiac-torso (NCAT) phantoms163). They              registered to a noncontrast CT (where the tumor is not visi-
are limited by the realism with which they represent human         ble) to enable tumor delineation, the user should assess the
anatomy and many features that are seen in human images            correspondence of the liver boundary. Qualitatively, this can
are impossible to reproduce in phantoms.                           be performed by displaying the CT liver contour on the MR
   Anthropomorphic deformable phantoms have been devel-            and evaluating the accuracy of the alignment. Quantitatively,
oped to validate deformable registration algorithms, including     the liver could be contoured on the CT and the MR and the
physical phantoms164–166 and digital phantoms. Physical            mean distance to agreement of the two contours could be cal-
deformable phantoms are complex, requiring motors to               culated. However, it should be noted that alignment of the
deform the shape and possible computer controllers to intro-       boundary of an organ between two images does not guarantee
duce deformations in a predictable manner. Deformable              that the internal volume of that organ is aligned.
phantoms are typically used for intramodality image registra-         Special care should be used when applying a registration
tion, mainly kV-CT to kV-CT, CBCT, or MV-CT. Use of                result to a third image. For example, if the CT from a CT-
deformable phantoms for multimodality image registration           PET scanner is registered to an MR and the transformation is
adds complexity, requiring phantoms to have components             subsequently applied to the PET from the CT-PET, the results
that are optimized for MR, PET, SPECT, and possibly US. It         should be carefully evaluated. The user should ensure the
is considered best practice to ensure that deformation model       resulting alignment between the MR and PET is accurate,
used to create the digitally deformed image is not the same        including first evaluating the alignment of the images
model that the image set is being used to evaluate.                obtained from the joined hardware system (e.g., the PET-CT)
                                                                   and the feasibility of the applied registration (e.g., if high
                                                                   activity from the PET is subsequently aligned into bone, this
4.E. Quality assurance at treatment planning and
                                                                   could possibly indicate an area of misregistration).
re-planning
                                                                      The validation for treatment adaptation involves the same
    It is important to note that during commissioning and soft-    components and process described above. Extra care should
ware upgrade, there are comprehensive quantitative evalua-         be taken in the QA process and integration of the registration
tions available because the user has the ground truth in           information into the re-planning process as the anatomical
phantom data. There is no comprehensive ground truth when          changes between the two images are often substantial and
dealing with deformable image registration in patients. Due        pose a significant challenge to image registration algorithms.
to this reason, there is no complete voxel-based quantitative
evaluation possible to find the true accuracy in patient regis-
                                                                   4.F. Quality assurance at treatment delivery
tration. However, users should evaluate if the transformation
is “reasonable” and no obvious error or ill behaviors. Some            The validity of the registration should be assessed prior to
quantitative evaluations can be performed, such as using the       treatment, at a minimum using qualitative assessment tools
Jacobian determinant method, to screen the transformation          described in section 4.A. In standard clinical practice, regis-
matrix for any ill behaviors, however, positive Jacobians do       tration at treatment delivery is limited to rigid registration to
not automatically guarantee the accuracy of the registration.      define a translational shift (and possibly a rotation) of the
Alternatively, the landmark-based evaluation could be used to      patient to provide a best-fit registration to the planning posi-
evaluate the accuracy of the algorithm if the users can iden-      tion. It is often the case that a rigid registration does not align
tify corresponding landmarks in two patient images. How-           all anatomy due to deformation (i.e., neck flexion in the treat-
ever, this does not guarantee that the areas without landmarks     ment of a tumor in the head and neck, changes in stomach
or between landmarks will be as accurate as the landmark           filling in the abdomen, or changes in bladder/rectum filling
registration indicates. Manual selection of landmarks also         in the pelvis). Following the pretreatment rigid registration, at
carries some uncertainties, especially in low contrast regions.    minimum the alignment of the tumor and critical normal tis-
    The validity of the image registration during treatment        sues should be qualitatively assessed. If large discrepancies
planning should be assessed following each registration, at a      are observed the patient should be re-evaluated, repositioned,

Medical Physics, 44 (7), July 2017
e58     Brock et al.: TG 132: Image registration                                                                                 e58


or the physician should be consulted. Semiquantitative evalu-        physical phantoms). Clinical data tests ensure final validation
ation of the discrepancy between alignment of different tis-         of the accuracy of the system on examples of the images
sues is also possible by focusing the registration (through the      expected in clinical use.
use of a clip-box, ROI, etc.) on the tumor, then the normal tis-        Recommendations from this report are summarized in
sues, and comparing the results of the registration. Retrospec-      Table IV.
tive assessment of these deviations over a population of
patients can help provide information for the generation of
                                                                     5.A.1. Software system speciﬁc validation
planning organ at risk volume (PRV) and PTVs at planning.
AAPM Task Group 179 also provides excellent information                  Validation of image registration software performance can
on the importance of QA at treatment delivery.167                    be divided into two broad areas, (a) validation of image trans-
                                                                     fer and data integrity between different systems and (b) vali-
                                                                     dation of the actual image registration functionality and
5. COMMISSIONING AND VALIDATION OF IMAGE                             accuracy. The data transfer integrity is also performed and
REGISTRATION SOFTWARE                                                recommended as a part of general commissioning of treat-
                                                                     ment planning systems and imaging devices used in
5.A. Commissioning
                                                                     RT.164,165 Changes in configuration of software or hardware
    As outlined in the previous sections the image registration      or upgrades of any scanner, computer, or network associated
process is susceptible to errors that can have a serious impact      with the RT planning have a potential of introducing errors
in patient treatment or evaluation. Quality assurance (QA) of        and disturbing established communications. Prior to upgrad-
the image registration process is essential for the validation of    ing or modifying any of the components, there should be a
post-transfer image data quality and spatial integrity, image        communication regarding which processes may be disturbed
orientation and chirality (i.e., absence of image mirroring),        and appropriate arrangements should be made for end-to-end
registration and/or deformation accuracy, and other system           testing following the changes. Chapter 7 of the AAPM TG53
functionality. As outlined in the AAPM TG53168 report, gen-          report discusses in detail issues related to management of
eral commissioning and routine procedural quality assurance          treatment planning systems and networks. The RT QA pro-
checks of a multimodality image registration process used for        gram should identify individuals responsible for system man-
treatment planning are important to ensure accurate patient          agement and should include tests for validation of proper
treatments.                                                          communication after system modifications. That component
    While it is impractical to address quality assurance of all      of the comprehensive RT QA program should already be in
individual systems and features that are commercially avail-         place based on AAPM TG53 and TG66 recommendations
able or developed in house, the tasks described here should          and should satisfy the needs of a multimodality image regis-
be essential elements to any image registration commission-          tration program.
ing and quality assurance programs. The exact design of the              Previously, in Section 4.E, phantoms were described for
commissioning process and routine QA tests will depend on            use in validation of image registration software. These phan-
individual system features and institutional goals. The overall      toms can be classified as virtual or physical phantoms. Vir-
goal of each QA program should be to ensure that images              tual phantoms can be used for performance of all tests
used for treatment planning, delivery, and evaluation are            outlined in Table IV. These tests range from validation of
accurately registered with remaining uncertainties accounted         very basic rigid registration to more complex deformable reg-
for, free of spatial distortions, and that the overall image qual-   istration and are the main focus of this report. Physical phan-
ity is preserved through various image manipulations. Fur-           toms are needed for end-to-end tests and for validation of
thermore, the QA process should ensure that propagation of           data transfer integrity as they can be physically imaged on
patient treatment planning data (contours, interest points,          various imaging devices and then images of these phantoms
dose distribution) through all image datasets used for plan          can be transferred through the image registration process,
creation should be consistent and accurate.                          simulating the actual steps that are used for patient data
    Commissioning is performed to investigate the accuracy           processing.
and reproducibility of the image registration techniques for
all sites and imaging modalities prior to clinical use. There
                                                                     5.A.2. System end-to-end tests with physical
are three methods recommended to assess registration results:        phantom
physical phantom system end-to-end tests, digital phantom
tests, and clinical data tests. A comprehensive commissioning            It is the recommendation of this task group that an end-to-
process should include all three components. Physical phan-          end test be performed during the commissioning, annually, at
tom tests enable end-to-end tests to ensure accurate data rep-       an image acquisition device repair or replacement with the
resentation, image transfer, and integrity verification between      potential to impact data integrity, or at each major image reg-
image acquisition devices, image registration systems, and           istration software upgrade, which is consistent with TG53168
other radiotherapy systems that use the image registration           and IAEA-430.169 The performance of end-to-end tests is a
results. Digital phantoms enable controlled testing of the           critical component to ensure the accuracy and consistency of
image registration accuracy (this may also be performed with         the overall function of the image acquisition, registration, and

Medical Physics, 44 (7), July 2017
e59        Brock et al.: TG 132: Image registration                                                                                                             e59


TABLE IV. Quality metrics and tolerances for commissioning, annual QA, and patient-specific QA for image registration.

Use case                                               Quality metric                                                          Tolerance

Commissioning, annual,     Data transfer (including orientation, image size, and data integrity),   Exact
and upon upgrade           performed from end-to-end across the entire system using a
                           physics phantom
                           Rigid registration accuracy (digital phantoms, subset)                   Baseline, see details in Table VI
                           Deformable registration accuracy (digital phantoms, subset)              Baseline, see details in Table VI
                           Example patient case verification ((including orientation,               Baseline, see details in Table VI
                           image size, and data integrity) using real clinical case
Each patient               Data transfer                                                            Exact
                           Patient orientation                                                      Image data matches specified orientation (superior/inferior,
                                                                                                    anterior/posterior, left/right)
                           Image size                                                               Qualitative – no observable distortions, correct aspect ratio
                           Data integrity and import                                                User defined per TG53 recommendations
                           Contour propagation                                                      Visual confirmation that visible boundaries are within
                                                                                                    1–2 voxels of contours
                           Rigid registration accuracy                                              At planning: confirmation that visible, relevant boundaries of
                                                                                                    anatomy in the registered images are within 1–2 voxels of the
                                                                                                    registered image; additional error should feed into margins
                                                                                                    At treatment: confirmation that visible boundaries are within
                                                                                                    PTV/PRV margins (doesn’t account for intrafraction motion)
                           Deformable registration accuracy                                         At planning: confirmation that visible, relevant boundaries and
                                                                                                    features of anatomy in the registered images are within
                                                                                                    1–2 voxels of the registered image; additional error should
                                                                                                    feed into margins; evaluate reasonableness of the deformation
                                                                                                    vector field; perform quantitative evaluation if results are
                                                                                                    questionable or if accuracy requirements are significant
                                                                                                    (e.g., SBRT, dose mapping for critical tissues)
                                                                                                    At treatment: confirmation that visible boundaries are within
                                                                                                    PTV/PRV margins (does not account for intrafraction motion)




planning/delivery procedure. If the registration is a stand-                         should be assessed by evaluating the registration of unam-
alone system, integrated between other components, e.g., the                         biguous landmarks in the phantom.
imaging devices and the treatment planning system, the end-                              The reliability of image and other data communications
to-end tests ensure compatibility and accuracy. It is also the                       between different hospital systems has been greatly simplified
recommendation of this task group that a simple end-to-end                           with wide acceptance of DICOM standard by various manu-
test is performed annually. For smaller, single physicist clin-                      facturers. While these systems have come a long way, incom-
ics, this provides the opportunity to invoke a ‘time out’ for                        patibility and implementation differences of DICOM
validation. For larger clinics, it ensures that the overall pro-                     standards among various manufacturers are still frequent
cess has not been altered without the knowledge of the physi-                        sources of errors, and image transfer tests should be per-
cist responsible for the registration component.                                     formed to verify proper transfer and processing of DICOM
    A multimodality (if necessary) physical phantom with                             objects. These tests should verify that images transferred
unambiguous internal landmarks and orientation should be                             from a scanner (CT, MRI, PET, SPECT), Picture Archiving
imaged on each scanner in head first supine, head first prone,                       and Communication System (PACS), or treatment machine
feet first supine, feet first prone orientations, and combination                    preserves the following items in the receiving image registra-
of decubitus and head/feet first orientations. It is important                       tion system: pixel size, slice thickness and spacing, orienta-
that each patient orientation be selected when programming                           tion (i.e., head/feet first, supine/prone, left/right), scan text
individual image acquisition sequences so the individual ori-                        information, and voxel value.
entations of the phantom are listed in DICOM headers of                                  Correct transfer and interpretation of image parameters
acquired images and then the correct identification and                              should be verified during the commissioning process and after
manipulation of each patient (image) orientation by the image                        all software and hardware upgrades as well as for each indi-
registration software can be verified. The images should be                          vidual patient. Often, secondary treatment planning datasets
imported into the image registration software and the correct                        are acquired at various outside institutions and evaluation of
orientation and image labeling should be verified. Image reg-                        data transfer from these systems cannot always be performed
istration between individual devices should be performed                             during commissioning. Validation of such dataset transfer
using standard clinical protocols. Accuracy of the registration                      should then be performed on an individual patient basis.


Medical Physics, 44 (7), July 2017
e60     Brock et al.: TG 132: Image registration                                                                                e60


   Validation of correct image geometry: Transfer of data            right side of the tabletop and along its entire length. The two
between systems that display images in different resolution or       wires should also form the letter “V” which is pointing
apply transformations to pixel locations can affect image            toward the gantry. The letter “V” indicates patient’s scan ori-
geometry due to pixel averaging, down-sampling, and various          entation (Head/Feet first). The wires should be small enough
other reasons.                                                       to avoid image artifacts. Such wires can be used on treatment
                                                                     machine couches as well. Use of couch mounted markers for
   Validation of correct image geometry requires a phantom
                                                                     MR, PET, and SPECT imaging is much more difficult due to
with test objects spaced at known distances throughout the
                                                                     nature of image acquisition and patient-specific fiducials are
phantom. The test involves scanning of the phantom with typ-
                                                                     an optimal solution for these modalities.
ical clinical protocols, image transfer, and measurement of
separations between the test objects. Validation should be
performed on each individual software package where con-                Validation of correct image parameters and spatial
touring or treatment planning work is performed with the             accuracy: Image files contain patient demographic informa-
evaluated images. The test objects should be placed so that          tion, image acquisition parameters, image orientation, voxel
the correct image geometry can be evaluated in all three             size, voxel locations, and individual voxel values. While
dimensions. The measurements should be accurate to half the          DICOM standards greatly improve accuracy of transferred
size of the voxel in the measurement direction. It is important      image datasets, it is possible that one or several of the above
to note that spatial distortions are not necessarily uniform and     parameters can become corrupt or misinterpreted during
may demonstrate only in one dimension. Validation of image           transfer.
size in three dimensions ensures correct pixel size, slice thick-
ness and spacing, and overall spatial fidelity. As already
described, MRI images may contain inherent spatial distor-           5.A.3. Digital phantom tests
tions, which should be separated from these tests. Other                 Digital phantoms can be developed in house or purchased
imaging modalities should not contain detectable distortions.        from vendors. The following digital phantom data, shown in
   The aim of the image geometry tests is to evaluate image          Table V, have been generated by this task group for use in
geometrical distortions due to data transfer between systems         commissioning and quality assurance programs for image
and not the inherent image distortions. If significant distortions   registration accuracy tests. The datasets were generated using
are observed in the transferred data, it should be first validated   ImSimQATM software (Oncology System Limited, UK (OSL,
that these distortions are not present when viewing images on        www.imismqa.com)). The datasets, or equivalent datasets,
the scanner console before proceeding with further testing. If       should be imported into the image registration software and
the distortions are inherent to the scanner, data transfer valida-   the tests outlined in Table IV should be performed. An alter-
tion should be repeated after the problem is rectified.              nating subset of these datasets should be used for testing
                                                                     annually or at time of upgrades. Image registration using the
                                                                     datasets in Table V should be performed in the clinical image
   Validation of correct image orientation: Validation of cor-
                                                                     registration system, as necessary per clinical activity.
rect image transfer orientation should be performed for all
                                                                         The following Table VI describes the tests and suggested
clinically used patient positioning orientations. A nonsym-
                                                                     tolerances for the rigid and deformable registration accuracy
metrical phantom or a phantom with fiducial markers should
                                                                     tests, for the digital phantom data described in Table V.
be scanned with all the clinically used patient orientation
                                                                     Deformable registration algorithms are currently an area of
combinations. Typical combinations are head first/supine;
                                                                     active research and commercialization. The selection of these
head first/prone, feet first/supine, feet first/prone, and combi-
                                                                     tolerances was driven by the clinical experience of the task
nation of decubitus and head/feet first orientation. A success-
                                                                     group and published validation studies.94,105,170 For example,
ful test results in the correct right/left, head/feet (superior/
                                                                     a multi-institutional study on clinical 4D CT lung data
inferior), and anterior/posterior labeling assigned to the trans-
                                                                     showed that 18 of the 21 participants could achieve a mean
ferred patient images, and all graphical orientation indicators
                                                                     absolute error of 2.0 mm or less and nine algorithms had a
are correct.
                                                                     maximum error of less than 5.0 mm in each direction.171 The
   Commissioning is also the best time to establish routine          tolerances listed are goals. If an algorithm does not meet the
use of image orientation fiducials placed either permanently         stated tolerance at commissioning, limitations should be
on a scanner, a treatment machine couch, or directly on              noted and expected uncertainties should be included in treat-
patients. The use of such fiducials is strongly recommended          ment protocols. Areas of larger expected uncertainties and
for all imaging procedures used in the RT patient treatment          algorithm limitations should be communicated to the multi-
process. Systematic use of orientation markers can reduce            disciplinary team.
likelihood of potentially serious treatment errors. The use of           Evaluating the accuracy of the deformation phantom
such markers is relatively straightforward in CT; TG66 has           should be performed using the DICOM deformation vector
recommended that two thin aluminum wires be taped on the             field (DVF) files. As stated in Section 4.A, image registration
bottom of the CT scanner tabletop to indicate patient orienta-       algorithms should export a DICOM DVF. The applied defor-
tion in CT images. The wires should be taped on the left or          mation is available on the AAPM website for the test

Medical Physics, 44 (7), July 2017
e61        Brock et al.: TG 132: Image registration                                                                                                                    e61


TABLE V. Digital phantom dataset generated by ImSimQATM software (Oncology System Limited, UK (OSL, www.imismqa.com)).

Dataset                                                                                                  Description

Basic phantom dataset - 1                     Reference dataset — HFS — black image with white and 3 shades of gray images. The voxel dimensions of all
                                              basic phantom datasets are 0.7 9 0.7 9 3 mm. Cone pointing superior, semicircle on right side, cube anterior to
                                              cylinder, 3 skin markers, and 3 internal markers, all in the same reference frame with defined perfect registration by
                                              generation of images with the following parameters:
                                              CT
                                              PET
                                              MRI T1-weighted (TR = 500 ms, TE = 12 ms)
                                              MRI T2-weighted (TR = 4000 ms, TE = 120 ms)
                                              CBCT (with noise added)
Basic phantom dataset - 2                     Same as basic phantom dataset - 1 -CT - with the following offsets: to left = 1.0 cm, to anterior = 0.5 cm,
                                              to inferior = 1.5 cm
Basic phantom dataset - 3                     Same as basic phantom dataset - 1 - CT - with the following offsets: to left = 0.5 cm, to anterior = 1.5 cm,
                                              to inferior = 2.0 cm, rotation = 5° about X-axis, +8° about Y-axis, +10° along Z-axis
Basic phantom dataset - 4                     Same as basic phantom dataset - 1 - CT - except it is FFS
Basic phantom dataset - 5                     Same as basic phantom dataset - 1 - CT - except it is HFP
Basic phantom dataset - 6                     Same as basic phantom dataset - 1 - CT - except it is FFP
Basic anatomical dataset -1                   Reference dataset – CT – HFS — the pelvis phantom provided by ImSimQATM software (oncology system limited,
                                              UK (OSL)) with 3 markers in the region of bladder, prostate, and rectum. The voxel dimensions of the CT, CBCT, and
                                              PET basic anatomical datasets are 0.91 9 0.91 9 3 mm. The voxel dimensions of the MR basic anatomical datasets
                                              are 1.83 9 1.83 9 3 mm.
Basic anatomical dataset -2                   Same as basic anatomical dataset -1 – CT - with offsets of: To left = 0.3 cm, to anterior = 0.5 cm, to inferior = 1.2 cm
Basic anatomical dataset -3                   Same as basic anatomical dataset -1 - PET – HFS - with offsets of: to left = 0.3 cm, to anterior = 0.5 cm, to
                                              inferior = 1.2 cm
Basic anatomical dataset -4                   Same as basic anatomical dataset -1 - MR-T1 – HFS - with offsets of: to left = 0.3 cm, to anterior = 0.5 cm,
                                              to inferior = 1.2 cm
Basic anatomical dataset -5                   Same as basic anatomical dataset -1 - MR-T2 – HFS - with offsets of: to left = 0.3 cm, to anterior = 0.5 cm,
                                              to inferior = 1.2 cm
Basic deformation dataset - 1                 Same as basic anatomical dataset - 1 with added Gaussian noise variation and the following
                                              global offsets: to left = 0.3 cm, to anterior = 0.5 cm, to inferior = 1.2 cm. Three markers were set inside the prostate,
                                              rectum, and bladder regions, prostate volume increased by 105%, 10° rotation about X-axis, +10° rotation
                                              about Y-axis, +10° rotation about Z-axis.
Clinical lung dataset – end                   DIR-Lab 4D CT dataset (end exhalation and end inhalation reconstruction only) with semiautomatically selected
exhalation and end inhalation                 bifurcation points (courtesy of the DIR-Lab, www.dir-lab.com/4DCT6.html)

HFS, head first supine; HFP, head first prone; FFS, feet first supine; FFP, feet first prone.




phantoms. The user should then subtract the DICOM images                                        obtained from typical patients previously treated in the
for each direction (i.e., the LR, AP, and SI directions are indi-                               clinic). The planned registration protocol should be per-
vidual DICOM files) and determine the percentage of voxels                                      formed on these 10 datasets and the results should be evalu-
that are within the tolerance.                                                                  ated using the quantitative and qualitative verification
                                                                                                techniques described in Sections 4.B and 4.C. The magni-
                                                                                                tude of the registration uncertainties resulting from these tests
5.A.4. Example clinical data tests
                                                                                                should be incorporated into the treatment protocols (e.g., into
   Once the standard operating level of the registration soft-                                  the uncertainty margins).
ware is assessed using the end-to-end tests on the physical
phantoms and the comprehensive validation using the digital
                                                                                                5.B. Patient-speciﬁc registration veriﬁcation during
phantoms, an evaluation of the registration accuracy should
                                                                                                clinical practice
be performed using example clinical datasets. These tests
should be designed based on the clinical protocols at each                                          Even the most comprehensive commissioning of the
institution using the quantitative and qualitative metrics                                      image registration algorithm cannot capture the entire scope
described in Sections 4.B and 4.C.                                                              of registration challenges that will be encountered in the
   For example, if a clinical protocol is planned to use                                        clinic. A well-documented patient-specific verification proto-
deformable image registration to propagate contours defined                                     col for routine practice is therefore essential as the image reg-
on one phase of a 4D CT onto all other phases of the 4D CT                                      istration is used for many activities during the radiotherapy
for lung tumor planning, an example set of 4D CT images                                         planning and treatment. Frequently, the registration is per-
should be collected from the clinic (e.g., 10 4D CT image sets                                  formed by one team member for use by another member for

Medical Physics, 44 (7), July 2017
e62       Brock et al.: TG 132: Image registration                                                                                                             e62


TABLE VI. Recommended tests and tolerances for the digital phantom test cases. See Table IV for recommended testing schedule. Here the voxel dimension
should be the calculated as the 3D vector magnitude of the image with the largest voxel size to reflect the nonisotropic size of most imaging voxels.

Stationary image                             Moving image                            Test                                          Tolerance

All datasets                                                           Voxel intensity                     Exact
                                                                       Orientation                         Exact
Basic phantom dataset - 2            Each modality image in            Rigid registration – Translation    Maximum cardinal direction error less than
                                     Basic phantom dataset – 1         only                                0.5*voxel dimension
Basic phantom dataset – 3            Each modality image in            Rigid registration – Translation    Maximum cardinal direction error less than
                                     Basic phantom dataset – 1         and rotation                        0.5*voxel dimension
Basic anatomical dataset - 1         Basic anatomical dataset - 2      Registration – translation only     Maximum cardinal direction error less than
                                                                                                           0.5*voxel dimension size
Basic anatomical dataset - 1         Basic anatomical dataset - 3      Registration – translation only     Maximum cardinal direction error less than
                                                                                                           0.5*voxel dimension size
Basic anatomical dataset - 1         Basic anatomical dataset - 4      Registration – translation only     Maximum cardinal direction error less than
                                                                                                           0.5*voxel dimension size
Basic anatomical dataset - 1         Basic anatomical dataset - 5      Registration – translation only     Maximum cardinal direction error less than
                                                                                                           0.5*voxel dimension size
Basic anatomical dataset - 1         Basic deformation dataset - 1     Deformable Registration             95% of voxels within the phantom within 2 mm
                                                                                                           Max error less than 5 mm
Sliding deformation dataset - 1      Sliding deformation dataset - 2   Deformable Registration             95% of voxels within the phantom within 2 mm
                                                                                                           Max error less than 5 mm
Clinical 4DCT dataset                (Deformation can be processed     Deformable registration             Mean vector error of all landmark points less than 2 mm
                                     in either direction)                                                  Max error less than 5 mm




TABLE VII. Registration uncertainty assessment level and description.

Uncertainty assessment                     Phrase                                                             Description

0                              Whole scan aligned                      • Anatomy within 1 mm everywhere
                                                                       • Useful for structure definition everywhere
                                                                       • Appropriate for stereotactic localization
1                              Locally aligned                         • Anatomy local to the area of interest is undistorted and aligned within 1 mm
                                                                       • Useful for structure definition within the local region
                                                                       • Appropriate for localization provided target is in locally aligned region
2                              Useable with risk of deformation        • Aligned locally, with mild anatomical variation
                                                                       • Acceptable registration required deformation which risks altering anatomy
                                                                       • Registered image shouldn’t be used solely for target definition as target may be deformed
                                                                       • Increased reliance on additional information is highly recommended
                                                                       • Registered image information should be used in complimentary manner and
                                                                          no image should be used by itself

3                              Useable for diagnosis only              • Registration not good enough to rely on geometric integrity
                                                                       • Possible use to identify general location of lesion (e.g., PET hot spot)
4                              Alignment not acceptable                • Unable to align anatomy to acceptable levels
                                                                       • Patient position variation too great between scans (e.g., surgical resection of the
                                                                          anatomy of interest or dramatic weight change between scans)




various tasks, therefore documentation of the registration                           registration in radiotherapy. The most effective procedure for
technique and patient-specific accuracy is essential to ensure                       ensuring effective communication depends on clinic size and
appropriate treatment of the patient.                                                structure. This task group recommends an image registration
   Communication regarding the needs and results of the                              directive analogous to treatment planning directives. The two
image registration between the multidisciplinary team is                             main communication interactions to address are the request
essential for the safe and efficient integration of image                            and the report. The request for an image registration

Medical Physics, 44 (7), July 2017
e63     Brock et al.: TG 132: Image registration                                                                                 e63


procedure should clearly identify the intended use of the             e. Sample fused images in report with annotations
result as well as indicate the region(s) of greatest importance.      f. Documentation from system used for fusion
Also, when the registration is performed at a time prior to the          Appendix B provides examples of an Image Registra-
use of the registration, the registration results should be              tion Request and Report form.
reported back to the multidisciplinary team with appropriate
indications of the accuracy of the registration and in which
local regions unusable results. Each use case poses its own
                                                                   6. CLINICAL INTEGRATION OF REGISTRATION
challenges and requirements, but in every case, clinical errors
                                                                   TECHNIQUES IN TREATMENT PLANNING AND
can be made if the communications related to image registra-
                                                                   DELIVERY
tion are misinterpreted. Language is proposed in Table VII to
describe the accuracy of an image registration.                       The clinical integration of successful image registration
   In general, the following elements of communication             programs should provide an efficient and safe practice. In
should be exchanged:                                               order to ensure the safe use of image registration, this task
                                                                   group recommends the following steps:
1. Request
                                                                      1). Clear guidelines are provided to the personnel imple-
   a. Clear identification of the image set(s) to be registered           menting the image registration,
                                                                      2). An efficient, patient-specific verification is performed
      i. Explicit identification of the primary reference                 for each image registration prior to its use (e.g., quali-
         image and the images to register to it                           tative assessment of registration results),
                                                                      3). Registration accuracy is assessed at a frequency to
   b. An understanding of the local region(s) of importance               minimize the effect of errors without prohibiting clini-
                                                                          cal flow,
         i. Anatomical regions and target location(s) or              4). Clear identification of the accuracy of the registration
        ii. Local landmarks or                                            is provided to the consumer of the image fusion so
       iii. Bounding box or other indicators on image                     they are fully aware of and can account for any
                                                                          uncertainties.
   c. The intended use of the result
      Examples:                                                        Commercially available systems provide advanced tools
                                                                   for image registration and fusion. In order to improve
         i. Target delineation                                     usability by a variety of users, the complexity, and often the
        ii. Dose compositing (retreatment)                         algorithms, is hidden from the user. The resulting risk is
       iii. 4D change assessment (normal and tumor tissue)         that the commercial systems provide capabilities to users
                                                                   that may not be fully understood. The inappropriate use of
   d. Techniques to use (appropriate for the intended use          these technologies can lead to potential errors in the treat-
                                                                   ment process. It is likely that all members of the multidisci-
       i. Deformable                                               plinary radiotherapy team will use or request the results of
      ii. Rigid                                                    the registration system. However, comprehensive knowledge
                                                                   of the algorithm and its limitations cannot be assumed for
   e. The accuracy required for the final use:                     all personnel. Therefore, for clinical implementation, it is
                                                                   the responsibility of the physicists to ensure proper training
         i. Explicitly stated or                                   of the personnel performing the image registration, that the
        ii. Implicitly defined by therapy plan scenario (e.g.,     personnel have an adequate understanding of how to use the
            stereotactic) or                                       system for each particular patient case, and that the algo-
       iii. Implicitly defined by intended use                     rithm is used in a safe manner, accounting for its uncertain-
                                                                   ties and limitations.
2. Report                                                              In addition, a patient-specific registration verification pro-
                                                                   cess should take place before the resulting data are used in
   a. Identify actual images used                                  the clinic. This might include quantitative measurements as
   b. Indicate the uncertainties in the final registration for     described above in Section 4.C, but should always include a
      local regions of importance and anatomical landmarks         qualitative evaluation across the entire dataset, described in
                                                                   Section 4.B. This patient-specific quality check serves to
      i. Identify any critical inaccuracies to alert the user      provide confidence to the user and helps to ensure safe oper-
                                                                   ation of these systems. In clinical practice, this verification
   c. Verify acceptable tolerances for use                         should be communicated to consumers of the results of the
   d. Techniques used to perform registration                      registration.


Medical Physics, 44 (7), July 2017
e64     Brock et al.: TG 132: Image registration                                                                                  e64


                                                                       the prostate for verification. Image registration for treatment
6.A. Treatment planning
                                                                       delivery is typically performed and applied by the same team
    The first critical component of image registration for treat-      of users; therefore, the communication of the registration
ment planning is a consistent patient position between all             results can be performed verbally within the team. It is imper-
imaging studies. For this reason, it is highly desirable to have       ative that the users are trained on how to quickly verify the
a process that allows imaging of the patient in the treatment          accuracy. A detailed protocol will provide a guide for thera-
position, and ideally in the immobilization used for treatment.        pists, and will make the registration process consistent for
This is not always practical, but any steps that can be made to        every patient case. If image guidance is to be used for an
better align the patient positions between multimodality               uncommon case for which no protocol has been developed, a
imaging and that used for treatment is beneficial to the pro-          clear directive of what is to be aligned for treatment and what
gram. External fiducial marker placement may also assist in            accuracy is required should be provided to the therapists prior
the preparation.                                                       to the onset of treatment or the physician should evaluate the
    Second, it is the recommendation of this task group that a         registration prior to treatment.
trained member of the radiotherapy team perform the image                  This task group recommends that the radiation therapist,
registration and fusion prior to treatment planning. This per-         adequately trained in image registration and the specific
son may also generate the report and recommend a level of              protocol, perform the image registration for treatment deliv-
uncertainty assessment, defined in Table VII.                          ery. This will facilitate efficient integration of image regis-
    Third, the user of the registration results (i.e., the radiation   tration into the treatment delivery process. Final validation
oncologist) should assess the registration accuracy and any            and use of image guidance should be decided on an institu-
tradeoffs made in the registration using methods described in          tional and protocol specific basis based on the training and
Sections 4.B and 4.C. The final review of the image registra-          experience of the multidisciplinary team, the interplay
tion for clinical use by the treating radiation oncologist is          between the IGRT technique and treatment margins, and
analogous to the final review of the dosimetric planning               regulatory guidelines. It is important that clinical operating
tradeoffs made by the radiation oncologist.                            principles be developed to avoid complacency and ensure
    Fourth, residual error in the registration that cannot be          efficient and safe treatment for patients. For final validation
resolved should be accounted for, e.g., in the treatment mar-          of image guidance for standard dose fractionation, it is often
gins (PTV).                                                            recommended that the radiation oncologist approve each
    As an example, referring back to the MR-CT registration            image registration used for treatment prior to the subsequent
for liver cancer described in 4.E. If an MR image is registered        treatment fraction delivered to the patient. Special consider-
to a CT for treatment planning, and the MR is used to delin-           ation should be given to higher fractional doses, greater
eate the GTV and the CT is used to delineate the normal tis-           than 5 Gy, such as that used in stereotactic radiosurgery.
sues and calculate the dose, an assessment of the registration         The current recommendation from the American Society for
accuracy should be performed. This could be a visual evalua-           Radiation Oncology (ASTRO) and American College of
tion of the liver boundary using a checkerboard technique or           Radiology (ACR) Practice Guideline for the Performance of
comparison of the spatial location of an identifiable marker           Stereotactic Body Radiation Therapy is for approval of the
(i.e., a clip or a branch in a blood vessel) on both images. If        image registration prior to delivery of the radiation by a
notable discrepancies are detected (i.e., greater than the voxel       radiation oncologist.172
size), the uncertainty should be estimated (by measuring the
distance between the boundaries of the liver or the difference
                                                                       6.C. Treatment monitoring and adaptation
in location of the marker). The closer the measured uncer-
tainty is to the GTV, the more representative it will be of the           Recently, the development of deformable image registra-
GTV registration accuracy. It may be appropriate to account            tion platforms has enabled sophisticated treatment monitor-
for this uncertainty as a potential systematic error in the pro-       ing, including dose accumulation in deforming anatomy,
cess. There are different philosophies that describe the incor-        e.g., the quantification of the dose delivered to subunits of
poration of these uncertainties into the treatment margin, e.g.,       the tissue over the course of treatment accounting for varia-
linear addition of the uncertainties or addition in quadrature,        tions in position and shape of organs through deformable
and a clear consensus within the radiation oncology commu-             registration, and the ability to perform more sophisticated
nity has not been reached.                                             adaptive replanning when anatomical or functional changes
                                                                       in the patient are observed. The validation requirements for
                                                                       this clinical process include those described above for both
6.B. Treatment delivery
                                                                       treatment planning and image guidance. Verification of
   For each treatment site, a written protocol (e.g., registra-        each image registration should be performed prior to the
tion request) should be developed providing a description of           use of the registration to accumulate the dose. However, it
what aspects of the image should be aligned for treatment              is important to note the use of deformable registration to
and identification of landmarks that can be used for verifica-         accumulate dose has additional demands on accuracy com-
tion. For example, for prostate, one may want to align the             pared to the use of deformable registration for contour
prostate rectum boundary for treatment, and use the apex of            propagation. For dose accumulation, the correspondence of

Medical Physics, 44 (7), July 2017
e65     Brock et al.: TG 132: Image registration                                                                                e65


every voxel receiving significant dose should be accurately
aligned, whereas for contour propagation the accuracy is
                                                                    • Two separate rigid registrations were performed, one to
                                                                      align T2 and the other to align T7
most important at the boundary of the organ. The use of
deformable registration for dose accumulation and subse-
                                                                    • Accuracy on the order of 1 mm was obtained for the
                                                                      vertebral bodies, determined by evaluating boundary of
quent adaptive replanning is outside of the scope of this             the bony structure and small, point-like calcifications
task group. It is recommended that these issues be
addressed in a subsequent task group. Protocols should be            The registration was approved; the target was contoured
defined to guide the process for each treatment site,            on the fused dataset using the fusion that was appropriate for
accounting for expected uncertainties and ensure detection       each vertebral body. No expansion was applied for the regis-
of unexpected levels of uncertainties. In addition, when         tration uncertainty.
using image registration for treatment adaptation or retreat-
ment of patients where there is a risk of exceeding normal          2. A liver patient is contrast intolerant and has a prior
tissue toxicity levels, the multidisciplinary team should dis-         MRI scan that clearly identifies the lesions in the left
cuss the uncertainties and limitations of the image registra-          lobe to be treated. The MRI was acquired in an arbi-
tion. This is currently an area of rapid innovation and                trary voluntary breath hold state and the patient is to be
caution should be used when employing these new tech-                  treated at an externally assisted exhale breath hold
niques until they are well understood.                                 state.

                                                                    Request
6.D. Clinical case illustrations                                    • Which MRI scan(s) from which study (i.e., Sagittal T1
                                                                      axial post contrast)
6.D.1. Target and critical structure segmentation at
planning                                                            • Treatment Planning CT is the primary
                                                                    • Left lobe of the liver is the most critical
   Below are two clinical case illustrations for the planning       • Intended use is target definition
request for image registration for structure segmentation, the      • Uncertainty in registration should be reported and
results of the registration, and the subsequent report.               added to the PTV margin
   1. A spinal stereotactic procedure is to be performed for
                                                                     Upon performing the registration, it was noted that defor-
      two lesions in T2 and T7 vertebral bodies. The physi-
                                                                 mation was present between the MR and CT scans. The regis-
      cian has reviewed the diagnostic MRI scans with 1 mm
                                                                 tration focused on the left lobe containing the tumor. The left
      voxel resolution and requests that they be registered to
                                                                 lobe of the liver aligned very well, the boundary of this lobe
      the treatment planning CT scan, with 1 mm slice thick-
                                                                 matched to within the voxel size.
      ness, to identify the target volumes for treatment.
                                                                     Report
      In this case the request should include the following
      information                                                   • T2 axial MR was registered with the treatment planning
                                                                      CT
   Request                                                          • Rigid registration focused on the left lobe, for purposes
   • Which MRI scan(s) from which study (i.e., Sagittal T1
                                                                      of tumor definition
      axial post contrast)                                          • Accuracy on the order of 2 mm was obtained for the left
   • Treatment Planning CT is the primary
                                                                      lobe
   • Regions of T2 and T7 vertebral bodies are most critical
   • Intended use is target definition for stereotactic RT
                                                                    The registration was approved, the tumor contour was gen-
   • Rigid registration should be used to avoid deforming
                                                                 erated based on the fused MR, and no expansion was deemed
                                                                 necessary for the registration uncertainty.
      the tumor
   • Desired accuracy is on the order of 1 mm to be consis-
      tent with the expected 1 mm accuracy of alignment at       6.D.2. Target registration and normal tissue
      treatment                                                  avoidance at treatment delivery
                                                                    The use of image registration in the treatment room should
   Upon performing the image registration, it was noticed
                                                                 be designed within the whole context of the planning and
that the spine was arched more in the MRI making it impossi-
                                                                 delivery workflow. An example workflow is shown in Fig. 6.
ble to align both T2 and T7 vertebral bodies with a single
                                                                 Currently, standard in-room image guidance requires a single
rigid registration. It was decided to use two separate rigid
                                                                 translation (plus possible rotation) to be applied to the
registrations to accomplish the goal.
                                                                 patient. This constraint in using the image registration
   Report
                                                                 requires tradeoffs in the registration process (i.e., the distribu-
   • Sagittal T1 axial post contrast was registered with the     tion of the residual errors following registration). These trade-
      treatment planning CT                                      offs should be accounted for in the planning process (e.g., if

Medical Physics, 44 (7), July 2017
e66     Brock et al.: TG 132: Image registration                                                    e66




                                           FIG. 6. Summary of an example image guidance protocol.




Medical Physics, 44 (7), July 2017
e67     Brock et al.: TG 132: Image registration                                                                             e67


targeting the tumor is the primary focus at treatment, a PRV          2. Understand the basic components of the registration
may be necessary at planning to ensure that the normal tissue            algorithm used clinically to ensure its proper use
is not overdosed). Advances in the field may reduce these             3. Perform end-to-end tests, using a physical phantom, of
requirements through the use of adaptive and real-time, in-              imaging, registration, and planning/treatment systems
room planning. The template for guidance shown above illus-              if image registration is performed on a stand-alone sys-
trates the need for image registration and assessment of regis-          tem
tration in the treatment room.                                        4. Perform comprehensive commissioning of image regis-
    Following patient setup and acquisition of the in-room               tration using the provided digital phantom data (or sim-
image, the field of view should be set for the image registra-           ilar data) as well as clinical data from the user’s
tion. This may be the entire image, a specific region of inter-          institution
est (e.g., the tumor), or a larger region of interest (e.g., the
entire neck). Once the field of view is set, the registration         a. Estimation of registration error should be assessed
technique should be selected, this should be designated in a             using a combination of the quantitative and qualitative
treatment protocol for the patient or class of patients. This            evaluation tools described in Tables III and IV. Regions
should include the similarity metric, transformation algo-               with larger estimated errors should be accounted for in
rithm, and optimization technique (as applicable). Following             the uncertainty margins used.
registration, the shift should be assessed to decide if the mag-
nitude is within specification and treatment should move for-         5. Develop a request and report system to ensure commu-
ward or if an intervention should occur (e.g., reset up the              nication and documentation between all users of image
patient). If moving forward, the registration accuracy should            registration
be assessed. It is important at this step that the registration       6. Establish a patient-specific QA practice for efficient
accuracy is assessed everywhere, not just within the specific            evaluation of image registration results
region of interest, to ensure that normal tissue avoidance is
maintained. The plan adequacy should be evaluated (e.g.,
with the applied correction, can the intended plan be deliv-
                                                                   7.B. Vendor recommendations
ered to within an allowable level of deviation). These criteria
will vary based on treatment site, protocol, and institution.
                                                                      1. Disclose basic components of their registration algo-
                                                                         rithm to ensure its proper use
7. CONCLUSIONS                                                        2. Provide the ability to export the registration matrix or
                                                                         deformation vector field for validation
   Image registration and fusion has the potential to improve
                                                                      3. Provide tools to qualitatively evaluate the image
the planning, delivery, and assessment of radiotherapy. How-
                                                                         registration
ever, as with any advanced technology used in the treatment
                                                                      4. Provide the ability to identify landmarks on two images
of patients, it should be commissioned and integrated into the
                                                                         and calculate the TRE from the registration
clinic in a safe and efficient manner. As the complexity of the
                                                                      5. Provide the ability to calculate the DSC and MDA
registration increases the validation, quality assurance, and
                                                                         between the contours defined on an image and the con-
verification methods needed in the commissioning and clini-
                                                                         tours mapped to the image via image registration
cal integration of the software also increases. As described in
                                                                      6. Support the integration of a request and report system
this task group report, the commissioning and quality assur-
                                                                         for image registration
ance program associated with an image registration applica-
tion is multifaceted. Only through the combination of
                                                                      This task group report aims to provide a comprehen-
multiple tests, can a complete assessment of the accuracy be
                                                                   sive, yet feasible, commissioning and QA system. The
obtained.
                                                                   image registration system should be commissioned for
   At the time of publication of this document, the tools
                                                                   clinical use, as per all other devices in the clinic. It is
needed to complete all recommended commissioning steps
                                                                   essential that the physicist understand the fundamental
outlined in this report are not standard in all commercial
                                                                   components of the algorithm to ensure its safe and appro-
algorithms. The purpose of this report was to also provide
                                                                   priate use in the clinic. In addition to commissioning, a
guidance to the vendors on the tools that are needed to effi-
                                                                   quality assurance process should be in place to ensure that
ciently perform these tasks within the commercial system.
                                                                   the clinical use of the registration is appropriate. The tests
   The recommendations of this task group can be summa-
                                                                   described in this report propose guidelines for both the
rized as follows:
                                                                   frequency and tolerance recommended to aid in the safe
                                                                   and effective use of image registration in the clinic. The
7.A. Clinical recommendations                                      individual protocols for each clinical department will drive
                                                                   further tailoring of these guidelines to include the addi-
   1. Understand the basic image registration techniques and       tional steps necessary for safe execution of the use of
      methods of visualizing image fusion                          image registration.

Medical Physics, 44 (7), July 2017
e68       Brock et al.: TG 132: Image registration                                                                                                           e68


                                                                                  and the DIR-lab, www.dir-lab.com for the generous use of
ACKNOWLEDGMENTS
                                                                                  one of the 4DCT datasets.
    Portions of the text from Sections 2 and 3 and Figs. 2,
4, and 5 are reprinted with permission of Springer
                                                                                  CONFLICT OF INTEREST
Science+Business Media from New Technologies in Radia-
tion Oncology, Medical Radiology 2006, pp. 41-52, Image                              Kristy Brock has a licensing agreement with RaySearch
Registration and Data Fusion for Radiotherapy Treatment                           Laboratories and a codevelopment agreement with Varian
Planning, Authors: Marc L. Kessler PhD, Michael Rober-                            Medical Systems. Sasa Mutic has a licensing agreement
son BS, © Springer-Verlag Berlin Heidelberg 2006. The                             with Modus, research and licensing agreements with Varian
authors thank Joanne Moseley, Princess Margaret Cancer                            Medical Systems, is a shareholder in Radialogica and a
Center, for the development of the pseudo-code available                          Treat safely Partner. Todd McNutt has a collaboration
on the AAPM website. The authors thank Oncology Sys-                              agreement with Philips Medical Systems and a licensing
tems Limited, UK (OSL, www.imsimqa.com) for the gen-                              agreement with Elekta Oncology Systems. Hua Li has a
erous use of their ImSimQATM digital phantom data which                           research agreement with Philips Medical Systems. Marc
will be made available for download on the AAPM web-                              Kessler has a research and codevelopment agreement with
site. The authors thank Richard Castillo, Ph.D., DABR,                            Varian Medical Systems.

APPENDIX A
RECOMMENDED ANATOMY TO QUALITATIVELY ASSESS IMAGE REGISTRATION ON A SITE-SPECIFIC
BASIS.


IMAGE REGISTRATION


Site                                                                           Anatomical landmark match

Brain                      Orbits, optic nerves, brainstem, ventricles, Sella Turcica, nose, external auditory canal (may be useful for minimizing rotation/roll),
                           and Clivus (for minimizing rotation/yaw errors) sagittal suture
Head and neck              If anterior facial tumor, fuse by maxilla, brainstem and orbits, and nose
Neck                       Cervical spine (one vertebral body above and below treatment site)
Chest                      T-spine or L-spine near the area
Chest wall                 Adjust T-spine in the area of treatment, then adjust to the closest ribs or by sternum
Abdomen                    Liver, spleen, and/or kidney boundary
                           Axial alignment of the abdominal aorta
Hand                       Metacarpals or phalanges
Wrist                      Carpal bones
Long bones                 Fuse joint to joint. If only one joint available, start there. Femoral head or humeral head depending on tumor location.
Pelvis                     Symphysis pubis, sacroiliac joint, sacrum, iliac crest, femoral head (may be useful for minimizing rotation/roll)
                           Prostate cancer: prostate, penile bulb
Foot                       Calcaneus and Tarsals or Metatarsals only if foot is flexed




Medical Physics, 44 (7), July 2017
e69       Brock et al.: TG 132: Image registration                                                    e69


APPENDIX B
EXAMPLE TEMPLATES OF AN IMAGE REGISTRATION REQUEST AND REPORT.


                                       Image Registration Request

   Primary Reference Image

   ‫ ס‬Simulaon CT ‫ ס‬MRI ‫ ס‬PET                 Date____________ Details_________________________

   Images to be registered to the primary reference image

   ‫ ס‬CT ‫ ס‬PET ‫ ס‬MRI (‫ ס‬sag ‫ ס‬cor ‫ ס‬axial) Date____________ Details_________________________

   ‫ ס‬CT ‫ ס‬PET ‫ ס‬MRI (‫ ס‬sag ‫ ס‬cor ‫ ס‬axial) Date____________ Details_________________________

   Intended Use

   ‫ ס‬Target or structure delineaon       ‫ ס‬Dose composing

   ‫ ס‬Moon management                     ‫ ס‬Disease progression or response

      Comment: ___________________________________________________________________________

   Local Regions of Importance

            Region                 Comment                                Landmarks

        1. _______________         ____________________________           _________________________

        2. _______________         ____________________________           _________________________

        3. _______________         ____________________________           _________________________

        4. _______________         ____________________________           _________________________

   Registraon Technique

   ‫ ס‬Rigid Only      ‫ ס‬Rigid and Deformable        ‫ ס‬Deformable only

   Accuracy Requirements

   ⃝ 0: Whole Scan Aligned

   ⃝ 1: Locally Aligned

   ⃝ 2: Useable if deformaon exists (registered image for complimentary informaon only)

   ⃝ 3: Registraon for diagnosis only (registraon needed to idenfy general area)

   Comment: ______________________________________________

   Requesng Physician: _________________________

                     Date: _________________________

              Signature: _________________________




Medical Physics, 44 (7), July 2017
e70       Brock et al.: TG 132: Image registration                                                       e70




                                        Image Registration Report

   Primary Reference Image:

   Modality_________ Date____________ Details_________________________

   Images to be registered to the primary reference image

   Modality_________ Date____________ Details_________________________ Technique___________

   Modality_________ Date____________ Details_________________________ Technique___________

   Intended Use

   ‫ ס‬Target or structure delineaon        ‫ ס‬Dose composing

   ‫ ס‬Moon management                      ‫ ס‬Disease progression or response

      Comment: ___________________________________________________________________________

   Local Region Alignment Accuracy

            Region/Metric       Accuracy Level                   Comment                   Screen Shot

        1. ____________         ________________________          ______________________       ‫ס‬

        2. ____________         ________________________          ______________________       ‫ס‬

        3. ____________         ________________________          ______________________       ‫ס‬

        4. ____________         ________________________          ______________________       ‫ס‬

   Accuracy Level

   ⃝ 0: Whole Scan Aligned

   ⃝ 1: Locally Aligned

   ⃝ 2: Useable with risk of deformaon (addional PTV/PRV margin may be required)

   ⃝ 3: Useable for diagnosis only (registraon only suitable to idenfy general area)

   ⃝ 4: Alignment not acceptable (Do Not Use!)

   Comment: ________________________________________________________________

   Notes:_______________________________________________________________________________
   _____________________________________________________________________________________
   _____________________________________________________________________________________

   Clinician Performing Registraon: ____________________________

                            Signature: _________________________ Date: ________________________




Medical Physics, 44 (7), July 2017
e71     Brock et al.: TG 132: Image registration                                                                          e71


APPENDIX C
SCREENSHOTS OF PHANTOM DATASETS.




                           FIG. C1. Simple geometric CT Phantom. [Color figure can be viewed at wileyonlinelibrary.com]




Medical Physics, 44 (7), July 2017
e72     Brock et al.: TG 132: Image registration                                                                     e72




                                FIG. C2. Pelvis CT Phantom. [Color figure can be viewed at wileyonlinelibrary.com]




Medical Physics, 44 (7), July 2017
e73       Brock et al.: TG 132: Image registration                                                                                                       e73

a)
 Author to whom correspondence should be addressed. Electronic mail:             23. Tanaka R, Sanada S, Suzuki M, et al. Breathing chest radiography
kkbrock@mdanderson.org.                                                              using a dynamic flat-panel detector combined with computer analysis.
                                                                                     Med Phys. 2004;31:2254–2262.
                                                                                 24. Studholme C, Hill DL, Hawkes DJ. Automated three-dimensional reg-
REFERENCES                                                                           istration of magnetic resonance and positron emission tomography
                                                                                     brain images by multiresolution optimization of voxel similarity mea-
  1. Ashburner J. A fast diffeomorphic image registration algorithm.                 sures. Med Phys. 1997;24:25–35.
      NeuroImage. 2007;38:95–113.                                                25. Bruckner T, Lucht R, Brix G. Comparison of rigid and elastic matching
  2. Brown LG. A survey of image registration techniques. ACM computing              of dynamic magnetic resonance mammographic images by mutual
      surveys (CSUR). 1992;24:325–376.                                               information. Med Phys. 2000;27:2456–2461.
  3. Collignon A, Maes F, Delaere D, Vandermeulen D, Suetens P, Marchal          26. Kim J, Fessler JA, Lam KL, Balter JM, Ten Haken RK. A feasibility
      G. Automated multi-modality image registration based on information            study of mutual information based setup error estimation for radiother-
      theory. Inform Process Med Imaging. 1995;3:263–274.                            apy. Med Phys. 2001;28:2507–2517.
  4. Hill DL, Batchelor PG, Holden M, Hawkes DJ. Medical image regis-            27. Klabbers BM, de Munck JC, Slotman BJ, et al. Matching PET and CT
      tration. Phys Med Biol. 2001;46:R1.                                            scans of the head and neck area: development of method and validation.
  5. Jenkinson M, Bannister P, Brady M, Smith S. Improved optimization               Med Phys. 2002;29:2230–2238.
      for the robust and accurate linear registration and motion correction of   28. Bond JE, Smith V, Yue NJ, Knisely JP. Comparison of an image regis-
      brain images. NeuroImage. 2002;17:825–841.                                     tration technique based on normalized mutual information with a stan-
  6. Maes F, Vandermeulen D, Suetens P. Comparative evaluation of mul-               dard method utilizing implanted markers in the staged radiosurgical
      tiresolution optimization strategies for multimodality image registra-         treatment of large arteriovenous malformations. Int J Radiat Oncol Biol
      tion by maximization of mutual information. Med Image Anal.                    Phys. 2003;57:1150–1158.
      1999;3:373–386.                                                            29. Clippe S, Sarrut D, Malet C, Miguet S, Ginestet C, Carrie C. Patient
  7. Zitova B, Flusser J. Image registration methods: a survey. Image Vis            setup error measurement using 3D intensity-based image registration
      Comput. 2003;21:977–1000.                                                      techniques. Int J Radiat Oncol Biol Phys. 2003;56:259–265.
  8. Maintz JA, Viergever MA. A survey of medical image registration.            30. Dekker N, Ploeger LS, van Herk M. Evaluation of cost functions for
      Med Image Anal. 1998;2:1–36.                                                   gray value matching of two-dimensional images in radiotherapy. Med
  9. van Herk M, de Munck JC, Lebesque JV, Muller S, Rasch C, Touw A.                Phys. 2003;30:778–784.
      Automatic registration of pelvic computed tomography data and mag-         31. Miga MI. A new approach to elastography using mutual information
      netic resonance scans including a full circle method for quantitative          and finite elements. Phys Med Biol. 2003;48:467–480.
      accuracy evaluation. Med Phys. 1998;25:2054–2067.                          32. Brock KM, Balter JM, Dawson LA, Kessler ML, Meyer CR. Auto-
 10. Cai J, Chu JC, Recine D, et al. CT and PET lung image registration              mated generation of a four-dimensional model of the liver using warp-
     and fusion in radiotherapy treatment planning using the chamfer-match-          ing and mutual information. Med Phys. 2003;30:1128–1133.
     ing method. Int J Radiat Oncol Biol Phys. 1999;43:883–891.                  33. Wu X, Dibiase SJ, Gullapalli R, Yu CX. Deformable image registration
 11. Jobse M, Davelaar J, Hendriks E, Kattevilder R, Reiber H, Stoel B. A            for the use of magnetic resonance spectroscopy in prostate treatment
     new algorithm for the registration of portal images to planning images          planning. Int J Radiat Oncol Biol Phys. 2004;58:1577–1583.
     in the verification of radiotherapy, as validated in prostate treatments.   34. Coselmon MM, Balter JM, McShan DL, Kessler ML. Mutual
     Med Phys. 2003;30:2274–2281.                                                    information based CT registration of the lung at exhale and
 12. van Herk M, Kooy HM. Automatic three-dimensional correlation of                 inhale breathing states using thin-plate splines. Med Phys.
     CT-CT, CT-MRI, and CT-SPECT using chamfer matching. Med Phys.                   2004;31:2942–2948.
     1994;21:1163–1178.                                                          35. Lavely WC, Scarfone C, Cevikalp H, et al. Phantom validation of
 13. Papavasileiou P, Flux GD, Guy MJ, Flower MA. A novel four-dimen-                coregistration of PET and CT for image-guided radiotherapy. Med
     sional image registration method for radionuclide therapy dosimetry.            Phys. 2004;31:1083–1092.
     Phys Med Biol. 2004;49:5373–5391.                                           36. Roberson PL, McLaughlin PW, Narayana V, Troyer S, Hixson GV,
 14. Sarrut D, Boldea V, Miguet S, Ginestet C. Simulation of four-dimen-             Kessler ML. Use and uncertainties of mutual information for computed
     sional CT images from deformable registration between inhale and                tomography/ magnetic resonance (CT/MR) registration post permanent
     exhale breath-hold CT scans. Med Phys. 2006;33:605–617.                         implant of the prostate. Med Phys. 2005;32:473–482.
 15. Shekhar R, Lei P, Castro-Pareja CR, Plishker WL, D’Souza WD. Auto-          37. Ji S, Wu Z, Hartov A, Roberts DW, Paulsen KD. Mutual-information-
     matic segmentation of phase-correlated CT scans through nonrigid                based image to patient re-registration using intraoperative ultrasound in
     image registration using geometrically regularized free-form deforma-           image-guided neurosurgery. Med Phys. 2008;35:4612–4624.
     tion. Med Phys. 2007;34:3054–3066.                                          38. Klein S, van der Heide UA, Lips IM, van Vulpen M, Staring M, Pluim
 16. Kunzler T, Grezdo J, Bogner J, Birkfellner W, Georg D. Registration of          JP. Automatic segmentation of the prostate in 3D MR images by atlas
     DRRs and portal images for verification of stereotactic body radiother-         matching using localized mutual information. Med Phys.
     apy: a feasibility study in lung cancer treatment. Phys Med Biol.               2008;35:1407–1417.
     2007;52:2157–2170.                                                          39. Park SB, Rhee FC, Monroe JI, Sohn JW. Spatially weighted mutual
 17. Yin Y, Hoffman EA, Lin CL. Mass preserving nonrigid registration of             information image registration for image guided radiation therapy. Med
     CT lung images using cubic B-spline. Med Phys. 2009;36:4213–4222.               Phys. 2010;37:4590–4601.
 18. Moseley J, Munro P. A semiautomatic method for registration of portal       40. Marinelli M, Martinez-Moller A, Jensen B, et al. Registration of
     images. Med Phys. 1994;21:551–558.                                              myocardial PET and SPECT for viability assessment using mutual
 19. Kano A, Doi K, MacMahon H, Hassell DD, Giger ML. Digital image                  information. Med Phys. 2010;37:2414–2424.
     subtraction of temporally sequential chest images for detection of inter-   41. Chappelow J, Bloch BN, Rofsky N, et al. Elastic registration of multi-
     val change. Med Phys. 1994;21:453–461.                                          modal prostate MRI and histology via multiattribute combined mutual
 20. Dong L, Boyer AL. An image correlation procedure for digitally recon-           information. Med Phys. 2011;38:2005–2018.
     structed radiographs and electronic portal images. Int J Radiat Oncol       42. Wells WM 3rd, Viola P, Atsumi H, Nakajima S, Kikinis R. Multi-
     Biol Phys. 1995;33:1053–1060.                                                   modal volume registration by maximization of mutual information.
 21. McParland BJ, Kumaradas JC. Digital portal image registration by                Med Image Anal. 1996;1:35–51.
     sequential anatomical matchpoint and image correlations for real-time       43. Viola P, Wells WM III. Alignment by maximization of mutual informa-
     continuous field alignment verification. Med Phys. 1995;22:1063–1075.           tion. Int J Comput Vision. 1997;24:137–154.
 22. Flynn AA, Green AJ, Boxer G, Pedley RB, Begent RH. A comparison             44. Hadjiiski L, Chan HP, Sahiner B, Petrick N, Helvie MA. Automated
     of image registration techniques for the correlation of radiolabelled            registration of breast lesions in temporal pairs of mammograms for
     antibody distribution with tumour morphology. Phys Med Biol.                     interval change analysis–local affine transformation for improved local-
     1999;44:N151–N159.                                                               ization. Med Phys. 2001;28:1070–1079.



Medical Physics, 44 (7), July 2017
e74       Brock et al.: TG 132: Image registration                                                                                                       e74


 45. Filev P, Hadjiiski L, Sahiner B, Chan HP, Helvie MA. Comparison of           69. Blumenfeld J, Studholme C, Carballido-Gamio J, Carpenter D, Link
     similarity measures for the task of template matching of masses on               TM, Majumdar S. Three-dimensional image registration of MR proxi-
     serial mammograms. Med Phys. 2005;32:515–529.                                    mal femur images for the analysis of trabecular bone parameters. Med
 46. Xiong L, Viswanathan A, Stewart AJ, et al. Deformable structure reg-             Phys. 2008;35:4630–4639.
     istration of bladder through surface mapping. Med Phys.                      70. Chao M, Penagaricano J, Yan Y, Moros EG, Corry P, Ratanatharathorn
     2006;33:1848–1856.                                                               V. Voxel-based dose reconstruction for total body irradiation with heli-
 47. Shi J, Sahiner B, Chan HP, et al. Pulmonary nodule registration in               cal tomotherapy. Int J Radiat Oncol Biol Phys. 2012;82:1575–1583.
     serial CT scans based on rib anatomy and nodule template matching.           71. Cunliffe AR, Al-Hallaq HA, Labby ZE, et al. Lung texture in serial
     Med Phys. 2007;34:1336–1347.                                                     thoracic CT scans: assessment of change introduced by image registra-
 48. Lamare F, Cresson T, Savean J, Cheze Le Rest C, Reader AJ, Visvikis              tion. Med Phys. 2012;39:4679–4690.
     D. Respiratory motion correction for PET oncology applications using         72. Delmon V, Rit S, Pinho R, Sarrut D. Registration of sliding objects
     affine transformation of list mode data. Phys Med Biol. 2007;52:121–140.         using direction dependent B-splines decomposition. Phys Med Biol.
 49. Jacobs MA, Windham JP, Soltanian-Zadeh H, Peck DJ, Knight RA.                    2013;58:1303–1314.
     Registration and warping of magnetic resonance images to histological        73. Faggiano E, Fiorino C, Scalco E, et al. An automatic contour propaga-
     sections. Med Phys. 1999;26:1568–1578.                                           tion method to follow parotid gland deformation during head-and-neck
 50. Lian J, Xing L, Hunjan S, et al. Mapping of the prostate in endorectal           cancer tomotherapy. Phys Med Biol. 2011;56:775–791.
     coil-based MRI/MRSI and CT: a deformable registration and validation         74. Hub M, Thieke C, Kessler ML, Karger CP. A stochastic approach to
     study. Med Phys. 2004;31:3087–3094.                                              estimate the uncertainty of dose mapping caused by uncertainties in b-
 51. Schaly B, Kempe JA, Bauman GS, Battista JJ, Van Dyk J. Tracking the              spline registration. Med Phys. 2012;39:2186–2192.
     dose distribution in radiation therapy by accounting for variable anat-      75. Jacobson TJ, Murphy MJ. Optimized knot placement for B-splines in
     omy. Phys Med Biol. 2004;49:791–805.                                             deformable image registration. Med Phys. 2011;38:4579–4582.
 52. Rosu M, Chetty IJ, Balter JM, Kessler ML, McShan DL, Ten Haken               76. Karnik VV, Fenster A, Bax J, et al. Assessment of image registration
     RK. Dose reconstruction in deforming lung anatomy: dose grid size                accuracy in three-dimensional transrectal ultrasound guided prostate
     effects and clinical implications. Med Phys. 2005;32:2487–2495.                  biopsy. Med Phys. 2010;37:802–813.
 53. Venugopal N, McCurdy B, Hnatov A, Dubey A. A feasibility study to            77. Karnik VV, Fenster A, Bax J, Romagnoli C, Ward AD. Evaluation of
     investigate the use of thin-plate splines to account for prostate deforma-       intersession 3D-TRUS to 3D-TRUS image registration for repeat pros-
     tion. Phys Med Biol. 2005;50:2871–2885.                                          tate biopsies. Med Phys. 2011;38:1832–1843.
 54. Malsch U, Thieke C, Huber PE, Bendl R. An enhanced block matching            78. Khallaghi S, Leung CG, Hastrudi-Zaad K, Foroughi P, Nguan C, Abol-
     algorithm for fast elastic registration in adaptive radiotherapy. Phys           maesumi P. Experimental validation of an intrasubject elastic registra-
     Med Biol. 2006;51:4789–4806.                                                     tion algorithm for dynamic-3D ultrasound images. Med Phys.
 55. Zhong H, Peters T, Siebers JV. FEM-based evaluation of deformable                2012;39:5488–5497.
     image registration for radiation therapy. Phys Med Biol. 2007;52:4721–       79. Lamare F, Ledesma Carbayo MJ, Cresson T, et al. List-mode-based
     4738.                                                                            reconstruction for respiratory motion correction in PET using non-rigid
 56. Xie Y, Chao M, Lee P, Xing L. Feature-based rectal contour propaga-              body transformations. Phys Med Biol. 2007;52:5187–5204.
     tion from planning CT to cone beam CT. Med Phys. 2008;35:4450–               80. Mori S, Furukawa T, Inaniwa T, et al. Systematic evaluation of four-
     4459.                                                                            dimensional hybrid depth scanning for carbon-ion lung therapy. Med
 57. Wu QJ, Thongphiew D, Wang Z, Chankong V, Yin FF. The impact of                   Phys. 2013;40:031720.
     respiratory motion and treatment technique on stereotactic body radia-       81. Pekar V, Gladilin E, Rohr K. An adaptive irregular grid approach for
     tion therapy for liver cancer. Med Phys. 2008;35:1440–1451.                      3D deformable image registration. Phys Med Biol. 2006;51:361–377.
 58. Xie Y, Chao M, Xing L. Tissue feature-based and segmented deform-            82. Petibon Y, Ouyang J, Zhu X, et al. Cardiac motion compensation and
     able image registration for improved modeling of shear movement of               resolution modeling in simultaneous PET-MR: a cardiac lesion detec-
     lungs. Int J Radiat Oncol Biol Phys. 2009;74:1256–1265.                          tion study. Phys Med Biol. 2013;58:2085–2102.
 59. Woo J, Slomka PJ, Dey D, et al. Geometric feature-based multimodal           83. Rietzel E, Chen GT. Deformable registration of 4D computed tomogra-
     image registration of contrast-enhanced cardiac CT with gated myocar-            phy data. Med Phys. 2006;33:4423–4430.
     dial perfusion SPECT. Med Phys. 2009;36:5467–5479.                           84. Rohlfing T, Maurer CR Jr, O’Dell WG, Zhong J. Modeling liver
 60. Narayanasamy G, LeCarpentier GL, Roubidoux M, Fowlkes JB, Schott                 motion and deformation during the respiratory cycle using intensity-
     AF, Carson PL. Spatial registration of temporally separated whole                based nonrigid registration of gated MR images. Med Phys.
     breast 3D ultrasound images. Med Phys. 2009;36:4288–4300.                        2004;31:427–432.
 61. Vasquez Osorio EM, Hoogeman MS, Bondar L, Levendag PC, Heijmen               85. Schreibmann E, Waller AF, Crocker I, Curran W, Fox T. Voxel cluster-
     BJ. A novel flexible framework with automatic feature correspondence             ing for quantifying PET-based treatment response assessment. Med
     optimization for nonrigid registration in radiotherapy. Med Phys.                Phys. 2013;40:012401.
     2009;36:2848–2859.                                                           86. Schreibmann E, Xing L. Narrow band deformable registration of pros-
 62. Bondar L, Hoogeman MS, Vasquez Osorio EM, Heijmen BJ. A sym-                     tate magnetic resonance imaging, magnetic resonance spectroscopic
     metric nonrigid registration method to handle large organ deformations           imaging, and computed tomography studies. Int J Radiat Oncol Biol
     in cervical cancer patients. Med Phys. 2010;37:3760–3772.                        Phys. 2005;62:595–605.
 63. Xie Y, Chao M, Xiong G. Deformable image registration of liver with          87. Shackleford JA, Kandasamy N, Sharp GC. On developing B-spline reg-
     consideration of lung sliding motion. Med Phys. 2011;38:5351–5361.               istration algorithms for multi-core processors. Phys Med Biol.
 64. Pallone MJ, Meaney PM, Paulsen KD. Surface scanning through a                    2010;55:6329–6351.
     cylindrical tank of coupling fluid for clinical microwave breast imaging     88. Shusharina N, Sharp G. Analytic regularization for landmark-based
     exams. Med Phys. 2012;39:3102–3111.                                              image registration. Phys Med Biol. 2012;57:1477–1498.
 65. Vasquez Osorio EM, Hoogeman MS, Mendez Romero A, Wielopolski                 89. Staring M, Klein S, Pluim JP. A rigidity penalty term for nonrigid reg-
     P, Zolnay A, Heijmen BJ. Accurate CTMR vessel-guided nonrigid reg-               istration. Med Phys. 2007;34:4098–4108.
     istration of largely deformed livers. Med Phys. 2012;39:2463–2477.           90. Staring M, Klein S, Pluim JP. Nonrigid registration with tissue-depen-
 66. Wognum S, Bondar L, Zolnay AG, et al. Control over structure-speci-              dent filtering of the deformation field. Phys Med Biol. 2007;52:6879–
     fic flexibility improves anatomical accuracy for point-based deformable          6892.
     registration in bladder cancer radiotherapy. Med Phys. 2013;40:021702.       91. Tang Q, Cammin J, Srivastava S, Taguchi K. A fully four-dimensional,
 67. Arganda-Carreras I, Sorzano CO, Thevenaz P, et al. Non-rigid consistent          iterative motion estimation and compensation method for cardiac CT.
     registration of 2D image sequences. Phys Med Biol. 2010;55:6215–6242.            Med Phys. 2012;39:4291–4305.
 68. Bai W, Brady M. Regularized B-spline deformable registration for res-        92. Tanner C, Schnabel JA, Hill DL, et al. Quantitative evaluation of free-
     piratory motion correction in PET images. Phys Med Biol.                         form deformation registration for dynamic contrast-enhanced MR
     2009;54:2719–2736.                                                               mammography. Med Phys. 2007;34:1221–1233.



Medical Physics, 44 (7), July 2017
e75       Brock et al.: TG 132: Image registration                                                                                                        e75


 93. van der Put RW, Kerkhof EM, Raaymakers BW, Jurgenliemk-                    115. Zhang T, Orton NP, Mackie TR, Paliwal BR. Technical note: a novel
     Schulz IM, Lagendijk JJ. Contour propagation in MRI-guided                      boundary condition using contact elements for finite element based
     radiotherapy treatment of cervical cancer: the accuracy of rigid,               deformable image registration. Med Phys. 2004;31:2412–2415.
     non-rigid and semi-automatic registrations. Phys Med Biol.                 116. Brock KK, Sharpe MB, Dawson LA, Kim SM, Jaffray DA. Accuracy
     2009;54:7135–7150.                                                              of finite element model-based multi-organ deformable image registra-
 94. Vandemeulebroucke J, Rit S, Kybic J, Clarysse P, Sarrut D. Spatiotem-           tion. Med Phys. 2005;32:1647–1659.
     poral motion estimation for respiratory-correlated imaging of the lungs.   117. Brock KK, Dawson LA, Sharpe MB, Moseley DJ, Jaffray DA. Feasibil-
     Med Phys. 2011;38:166–178.                                                      ity of a novel deformable image registration technique to facilitate clas-
 95. Vos PC, Hambrock T, Barenstz JO, Huisman HJ. Computer-assisted                  sification, targeting, and monitoring of tumor and normal tissue. Int J
     analysis of peripheral zone prostate lesions using T2-weighted and              Radiat Oncol Biol Phys. 2006;64:1245–1254.
     dynamic contrast enhanced T1-weighted MRI. Phys Med Biol.                  118. Tanner C, Schnabel JA, Hill DL, Hawkes DJ, Leach MO, Hose DR.
     2010;55:1719–1734.                                                              Factors influencing the accuracy of biomechanical breast models. Med
 96. Wang J, Gu X. High-quality four-dimensional cone-beam CT by                     Phys. 2006;33:1758–1769.
     deforming prior images. Phys Med Biol. 2013;58:231–246.                    119. Alterovitz R, Goldberg K, Pouliot J, et al. Registration of MR prostate
 97. Wu Z, Rietzel E, Boldea V, Sarrut D, Sharp GC. Evaluation of deform-            images with biomechanical modeling and nonlinear parameter estima-
     able registration of patient lung 4DCT with subanatomical region seg-           tion. Med Phys. 2006;33:446–454.
     mentations. Med Phys. 2008;35:775–781.                                     120. Chi Y, Liang J, Yan D. A material sensitivity study on the accuracy of
 98. Xiong G, Chen C, Chen J, Xie Y, Xing L. Tracking the motion trajecto-            deformable organ registration using linear biomechanical models. Med
     ries of junction structures in 4D CT images of the lung. Phys Med Biol.          Phys. 2006;33:421–433.
     2012;57:4905–4930.                                                         121. Wu Q, Liang J, Yan D. Application of dose compensation in image-guided
 99. Yan C, Zhong H, Murphy M, Weiss E, Siebers JV. A pseudoinverse                  radiotherapy of prostate cancer. Phys Med Biol. 2006;51:1405–1419.
     deformation vector field generator and its applications. Med Phys.         122. Hensel JM, Menard C, Chung PW, et al. Development of multiorgan
     2010;37:1117–1128.                                                               finite element-based prostate deformation model enabling registration
100. Zhang C, Villa-Uriol MC, De Craene M, Pozo JM, Macho JM,                         of endorectal coil magnetic resonance imaging for radiotherapy plan-
     Frangi AF. Dynamic estimation of three-dimensional cerebrovascular               ning. Int J Radiat Oncol Biol Phys. 2007;68:1522–1528.
     deformation from rotational angiography. Med Phys. 2011;38:                123. Kaus MR, Brock KK, Pekar V, Dawson LA, Nichol AM, Jaffray DA.
     1294–1306.                                                                       Assessment of a model-based deformable image registration approach
101. Zhong H, Kim J, Chetty IJ. Analysis of deformable image registra-                for radiation therapy planning. Int J Radiat Oncol Biol Phys.
     tion accuracy using computational modeling. Med Phys. 2010;37:                   2007;68:572–580.
     970–979.                                                                   124. Nichol AM, Brock KK, Lockwood GA, et al. A magnetic resonance
102. Wang H, Dong L, O’Daniel J, et al. Validation of an accelerated                  imaging study of prostate deformation relative to implanted gold fidu-
     ‘demons’ algorithm for deformable image registration in radiation ther-          cial markers. Int J Radiat Oncol Biol Phys. 2007;67:48–56.
     apy. Phys Med Biol. 2005;50:2887–2905.                                     125. Brock KK, Nichol AM, Menard C, et al. Accuracy and sensitivity of
103. Martel AL, Froh MS, Brock KK, Plewes DB, Barber DC. Evaluating                   finite element model-based deformable registration of the prostate.
     an optical-flow-based registration algorithm for contrast-enhanced               Med Phys. 2008;35:4019–4025.
     magnetic resonance imaging of the breast. Phys Med Biol.                   126. Al-Mayah A, Moseley J, Brock KK. Contact surface and material non-
     2007;52:3803–3816.                                                               linearity modeling of human lungs. Phys Med Biol. 2008;53:305–317.
104. Yang D, Li H, Low DA, Deasy JO, El Naqa I. A fast inverse consistent       127. Al-Mayah A, Moseley J, Velec M, Brock KK. Sliding characteristic
     deformable image registration method based on symmetric optical flow            and material compressibility of human lung: parametric study and veri-
     computation. Phys Med Biol. 2008;53:6143–6165.                                  fication. Med Phys. 2009;36:4625–4633.
105. Castillo R, Castillo E, Guerra R, et al. A framework for evaluation of     128. Nguyen TN, Moseley JL, Dawson LA, Jaffray DA, Brock KK. Adapt-
     deformable image registration spatial accuracy using large landmark              ing liver motion models using a navigator channel technique. Med
     point sets. Phys Med Biol. 2009;54:1849–1870.                                    Phys. 2009;36:1061–1073.
106. Schreibmann E, Nye JA, Schuster DM, Martin DR, Votaw J, Fox T.             129. Al-Mayah A, Moseley J, Velec M, Hunter S, Brock K. Deformable
     MR-based attenuation correction for hybrid PET-MR brain imaging                  image registration of heterogeneous human lung incorporating the
     systems using deformable image registration. Med Phys. 2010;37:2101–             bronchial tree. Med Phys. 2010;37:4560–4571.
     2109.                                                                      130. Al-Mayah A, Moseley J, Hunter S, et al. Biomechanical-based image
107. Ehrhardt J, Werner R, Saring D, et al. An optical flow based method              registration for head and neck radiation treatment. Phys Med Biol.
     for improved reconstruction of 4D CT data sets acquired during free              2010;55:6491–6500.
     breathing. Med Phys. 2007;34:711–721.                                      131. Alonzo-Proulx O, Packard N, Boone JM, et al. Validation of a method
108. Wolthaus JW, Sonke JJ, van Herk M, Damen EM. Reconstruction of a                for measuring the volumetric breast density from digital mammograms.
     time-averaged midposition CT scan for radiotherapy planning of lung             Phys Med Biol. 2010;55:3027–3044.
     cancer patients using deformable registration. Med Phys.                   132. Eccles CL, Dawson LA, Moseley JL, Brock KK. Interfraction liver
     2008;35:3998–4011.                                                               shape variability and impact on GTV position during liver stereotactic
109. Gu X, Dong B, Wang J, et al. A contour-guided deformable image reg-              radiotherapy using abdominal compression. Int J Radiat Oncol Biol
     istration algorithm for adaptive radiotherapy. Phys Med Biol.                    Phys. 2011;80:938–946.
     2013;58:1889–1901.                                                         133. Al-Mayah A, Moseley J, Velec M, Brock K. Toward efficient biome-
110. Hou J, Guerrero M, Chen W, D’Souza WD. Deformable planning CT                    chanical-based deformable image registration of lungs for image-
     to cone-beam CT image registration in head-and-neck cancer. Med                  guided radiotherapy. Phys Med Biol. 2011;56:4701–4713.
     Phys. 2011;38:2088–2094.                                                   134. Zhong H, Kim J, Li H, Nurushev T, Movsas B, Chetty IJ. A finite ele-
111. Bharatha A, Hirose M, Hata N, et al. Evaluation of three-dimensional             ment method to correct deformable image registration errors in low-
     finite element-based deformable registration of pre- and intraoperative          contrast regions. Phys Med Biol. 2012;57:3499–3515.
     prostate imaging. Med Phys. 2001;28:2551–2560.                             135. Han L, Hipwell JH, Tanner C, et al. Development of patient-specific
112. Brock KK, Hollister SJ, Dawson LA, Balter JM. Technical note: creat-             biomechanical models for predicting large breast deformation. Phys
     ing a four-dimensional model of the liver using finite element analysis.         Med Biol. 2012;57:455–472.
     Med Phys. 2002;29:1403–1405.                                               136. Levin DN, Pelizzari CA, Chen G, Chen C, Cooper M. Retrospective
113. Liang J, Yan D. Reducing uncertainties in volumetric image based                 geometric correlation of MR, CT, and PET images. Radiology.
     deformable organ registration. Med Phys. 2003;30:2116–2122.                      1988;169:817–823.
114. Brock KK, McShan DL, Ten Haken RK, Hollister SJ, Dawson LA, Bal-           137. Hill DL, Hawkes DJ, Hardingham CR. Use of anatomical knowledge to
     ter JM. Inclusion of organ deformation in dose calculations. Med Phys.          register 3-D blood vessel data derived from DSA with MR images. Med
     2003;30:290–295.                                                                Imaging. 1991;348–357.



Medical Physics, 44 (7), July 2017
e76       Brock et al.: TG 132: Image registration                                                                                                      e76


138. Fright WR, Linney AD. Registration of 3-D head surfaces using multi-       156. Langen KM, Zhang Y, Andrews RD, et al. Initial experience with
     ple landmarks. IEEE Trans Med Imaging. 1993;12:515–520.                          megavoltage (MV) CT guidance for daily prostate alignments. Int J
139. Gilhuijs K, Van Herk M. Automatic on-line inspection of patient setup            Radiat Oncol Biol Phys. 2005;62:1517–1524.
     in radiation therapy using digital portal images. Med Phys.                157. Fitzpatrick JM, West JB, Maurer CR Jr. Predicting error in rigid-body
     1993;20:667–677.                                                                point-based registration. IEEE Trans Med Imaging. 1998;17:694–702.
140. Hill DL, Hawkes DJ, Harrison NA, Ruff CF. A strategy for automated         158. Persson GF, Nygaard DE, Hollensen C, et al. Interobserver delineation
     multimodality image registration incorporating anatomical knowledge              variation in lung tumour stereotactic body radiotherapy. Br J Radiol.
     and imager characteristics. Biennial Int Conf Inf Process Med Imaging.           2012;85:e654–e660.
     1993;182–196.                                                              159. Brouwer CL, Steenbakkers RJ, vanden Heuvel E, et al. 3D Variation in
141. Hua P, Fram I. Feature-based image registration for digital subtraction          delineation of head and neck organs at risk. Radiat Oncol. 2012;7:32.
     angiography. Med Imaging. 1993;1993:24–31.                                 160. Nelms BE, Tome WA, Robinson G, Wheeler J. Variations in the con-
142. Miller MI, Christensen GE, Amit Y, Grenander U. Mathematical text-              touring of organs at risk: test case from a patient with oropharyngeal
     book of deformable neuroanatomies. Proc Natl Acad Sci.                          cancer. Int J Radiat Oncol Biol Phys. 2012;82:368–378.
     1993;90:11944–11948.                                                       161. Dice LR. Measures of the Amount of Ecologic Association Between
143. Bettinardi V, Gilardi MC, Lucignani G, et al. A procedure for patient           Species. Ecology. 1945;26:297–302.
     repositioning and compensation for misalignment between transmis-          162. Chalana VK, Kim Y. A methodology for evaluation of boundary detec-
     sion and emission data in PET heart studies. J Nucl Med. 1993;34:               tion algorithms on medical images. IEEE Trans Med Imaging. 1997;
     137–142.                                                                        16:642–652.
144. Van den Elsen PA, Pol E-J, Viergever MA. Medical image match-              163. Segars WP, Tsui BM, Lalush DS, Frey EC, king MA, Manocha D.
     ing-a review with classification. IEEE Eng Med Biol Mag.                        Development and application of the new dynamic Nurbs-based Car-
     1993;12:26–39.                                                                  diac-Torso (NCAT) phantom. J Nucl Med. 2001;42:23.
145. Woods RP, Mazziotta JC, Cherry SR. MRI-PET registration with auto-         164. Kashani R, Hub M, Kessler ML, Balter JM. Technical note: a physical
     mated algorithm. J Comput Assist Tomogr. 1993;17:536–546.                       phantom for assessment of accuracy of deformable alignment algo-
146. Liu A, Pizer SM, Eberly DH, et al. Volume registration using the 3D             rithms. Med Phys. 2007;34:2785–2788.
     core. Visual Biomed Comput. 1994;1994:217–226.                             165. Serban M, Heath E, Stroian G, Collins DL, Seuntjens J. A deformable
147. Kirby N, Chuang C, Pouliot J. A two-dimensional deformable phantom              phantom for 4D radiotherapy verification: design and image registra-
     for quantitatively verifying deformation algorithms. Med Phys.                  tion evaluation. Med Phys. 2008;35:1094–1102.
     2011;38:4583–4586.                                                         166. Vinogradskiy YY, Balter P, Followill DS, Alvarez PE, White RA,
148. Juang T, Das S, Adamovics J, Benning R, Oldham M. On the need for               Starkschall G. Comparing the accuracy of four-dimensional photon
     comprehensive validation of deformable image registration, investi-             dose calculations with three-dimensional calculations using moving
     gated with a novel 3-dimensional deformable dosimeter. Int J Radiat             and deforming phantoms. Med Phys. 2009;36:5000–5006.
     Oncol Biol Phys. 2013;87:414–421.                                          167. Bissonnette JP, Balter PA, Dong L, et al. Quality assurance for image-
149. Christiansen HN, Sederberg TW. Conversion of complex contour line               guided radiation therapy utilizing CT-based technologies: a report of
     definitions into polygonal element mosaics. ACM Siggraph Computer               the AAPM TG-179. Med Phys. 2012;39:1946–1963.
     Graphics. 1978;12:187–192.                                                 168. Fraass B, Doppke K, Hunt M, et al. American Association of Physi-
150. Brock KK. Imaging and image-guided radiation therapy in liver cancer.           cists in Medicine Radiation Therapy Committee Task Group 53: quality
     Sem Radiat Oncol. 2011;21:247–255.                                              assurance for clinical radiotherapy treatment planning. Med Phys.
151. Murphy MJ. Image-guided patient positioning: if one cannot correct              1998;25:1773–1829.
     for rotational offsets in external-beam radiotherapy setup, how            169. Agency IAE. Commissioning and Quality Assurance of Computerized
     should rotational offsets be managed? Med Phys. 2007;34:1880–                   Planning Systems for Radiation Treatment of Cancer. Vienna: Interna-
     1883.                                                                           tional Atomic Energy Agency; 2004:281.
152. Eisenhauer EA, Therasse P, Bogaerts J, et al. New response evaluation      170. Kashani R, Hub M, Balter JM, et al. Objective assessment of deform-
     criteria in solid tumours: revised RECIST guideline (version 1.1). Eur J        able image registration in radiotherapy: a multi-institution study. Med
     Cancer. 2009;45:228–247.                                                        Phys. 2008;35:5944–5953.
153. Badawi AM, Weiss E, Sleeman WC, Hugo GD. Classifying geometric             171. K. K. Brock and D. R. A. Consortium. Results of a multi-institution
     variability by dominant eigenmodes of deformation in regressing                 deformable registration accuracy study (MIDRAS). Int J Radiat Oncol
     tumours during active breath hold lung cancer radiotherapy. Phys Med            Biol Phys. 2010;76:583–596.
     Biol. 2012;57:395–413.                                                     172. Potters L, Kavanagh B, Galvin JM, et al., R. American Society for
154. Kessler ML. Image registration and data fusion in radiation therapy. Br         Therapeutic, Oncology, and R. American College of Radiology. Ameri-
     J Radiol. 2006;79:S99–S108.                                                     can Society for Therapeutic Radiology and Oncology (ASTRO) and
155. Court LE, Dong L, Taylor N, et al. Evaluation of a contour-alignment            American College of Radiology (ACR) practice guideline for the per-
     technique for CT-guided prostate radiotherapy: an intra- and interob-           formance of stereotactic body radiation therapy. Int J Radiat Oncol Biol
     server study. Int J Radiat Oncol Biol Phys. 2004;59:412–418.                    Phys. 2010;76:326–332.




Medical Physics, 44 (7), July 2017
